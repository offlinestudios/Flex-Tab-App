<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <title>FlexTab – Dashboard Preview</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    * { font-family: 'Inter', sans-serif; box-sizing: border-box; }
    body { background: #f0f1f3; margin: 0; overflow-x: hidden; }

    /* ── Counter rows ── */
    .counter-row { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid #f0f1f3; }
    .counter-row:last-of-type { border-bottom: none; }
    .counter-btn { width: 42px; height: 42px; border-radius: 50%; background: #f0f1f3; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 22px; color: #555; border: none; transition: background .15s; flex-shrink: 0; user-select: none; }
    .counter-btn:hover { background: #e2e4e7; }
    .counter-val { font-size: 30px; font-weight: 800; color: #1a2332; min-width: 64px; text-align: center; }

    /* ── Buttons ── */
    .btn-primary { width: 100%; background: #1a2332; color: white; border: none; border-radius: 16px; padding: 16px; font-size: 16px; font-weight: 700; cursor: pointer; transition: background .15s; }
    .btn-primary:hover { background: #243044; }
    .btn-secondary { width: 100%; background: white; color: #1a2332; border: 1.5px solid #e2e4e7; border-radius: 16px; padding: 14px; font-size: 15px; font-weight: 600; cursor: pointer; transition: border-color .15s; }
    .btn-secondary:hover { border-color: #1a2332; }

    /* ── Exercise card ── */
    .exercise-card { background: white; border-radius: 20px; border: 1px solid #f0f1f3; overflow: hidden; margin-bottom: 16px; animation: slideIn .3s ease; }

    /* ── Sidebar ── */
    #sidebar { transform: translateX(-100%); transition: transform .3s ease; }
    #sidebar.open { transform: translateX(0); }

    /* ── Sidebar nav item ── */
    .sidebar-nav-item { display: flex; align-items: center; gap: 12px; padding: 13px 20px; cursor: pointer; border-radius: 14px; transition: background .15s; color: #6b7280; font-size: 15px; font-weight: 500; }
    .sidebar-nav-item:hover { background: #f5f6f8; color: #1a2332; }
    .sidebar-nav-item.active { background: #1a2332; color: white; }
    .sidebar-nav-item.active svg { stroke: white; }

    /* ── Exercise browser overlay ── */
    #exercise-browser { position: fixed; inset: 0; background: white; z-index: 80; transform: translateY(100%); transition: transform .35s cubic-bezier(.4,0,.2,1); display: flex; flex-direction: column; }
    #exercise-browser.open { transform: translateY(0); }

    /* ── Routine builder overlay ── */
    #routine-builder { position: fixed; inset: 0; background: white; z-index: 85; transform: translateY(100%); transition: transform .35s cubic-bezier(.4,0,.2,1); display: flex; flex-direction: column; }
    #routine-builder.open { transform: translateY(0); }

    /* ── Body part pill ── */
    .bp-pill { padding: 8px 18px; border-radius: 20px; font-size: 13px; font-weight: 600; border: 1.5px solid #e2e4e7; background: white; color: #6b7280; cursor: pointer; white-space: nowrap; transition: all .15s; flex-shrink: 0; }
    .bp-pill.active { background: #1a2332; color: white; border-color: #1a2332; }

    /* ── Exercise list item ── */
    .ex-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; border-bottom: 1px solid #f5f6f8; cursor: pointer; transition: background .12s; }
    .ex-item:hover { background: #f9fafb; }
    .ex-icon { width: 40px; height: 40px; background: #f5f6f8; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

    /* ── Bottom nav ── */
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e8e9eb; display: flex; justify-content: space-around; padding: 8px 16px 16px; z-index: 50; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 3px; padding: 4px 16px; cursor: pointer; }
    .nav-item span { font-size: 11px; color: #9ca3af; font-weight: 500; }
    .nav-item.active span { color: #1a2332; font-weight: 700; }

    /* ── Community feed ── */
    .feed-card { background: white; border-radius: 20px; border: 1px solid #f0f1f3; overflow: hidden; margin-bottom: 14px; }
    .feed-card-media { width: 100%; aspect-ratio: 1; object-fit: cover; display: block; background: #f0f1f3; }
    .like-btn { display: flex; align-items: center; gap: 5px; padding: 7px 14px; border-radius: 20px; border: 1.5px solid #e2e4e7; background: white; font-size: 13px; font-weight: 600; color: #6b7280; cursor: pointer; transition: all .15s; }
    .like-btn.liked { background: #fee2e2; border-color: #fca5a5; color: #ef4444; }
    .like-btn:hover:not(.liked) { border-color: #1a2332; color: #1a2332; }
    .comment-input-row { display: flex; align-items: center; gap: 8px; padding: 10px 16px; border-top: 1px solid #f0f1f3; }
    .comment-input { flex: 1; background: #f5f6f8; border: none; border-radius: 20px; padding: 9px 14px; font-size: 13px; color: #1a2332; outline: none; }
    .post-composer { background: white; border-radius: 20px; border: 1px solid #f0f1f3; padding: 16px; margin-bottom: 14px; }
    .composer-type-btn { flex: 1; padding: 9px 12px; border-radius: 12px; border: 1.5px solid #e2e4e7; background: white; font-size: 13px; font-weight: 600; color: #6b7280; cursor: pointer; transition: all .15s; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .composer-type-btn.active { background: #1a2332; color: white; border-color: #1a2332; }
    .composer-type-btn.active svg { stroke: white; }

    /* ── History row ── */
    .history-row { background: #f5f6f8; border-radius: 12px; padding: 12px; margin-bottom: 8px; }

    /* ── Routine card ── */
    .routine-card { background: white; border: 1.5px solid #e2e4e7; border-radius: 16px; padding: 14px 16px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; cursor: pointer; transition: border-color .15s; }
    .routine-card:hover { border-color: #1a2332; }

    /* ── RB exercise item ── */
    .rb-ex-item { display: flex; align-items: center; gap: 10px; padding: 12px 14px; border-bottom: 1px solid #f5f6f8; cursor: pointer; transition: background .12s; }
    .rb-ex-item:hover { background: #f9fafb; }
    .rb-ex-item.selected { background: #1a2332; }

    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn  { from { opacity: 0; } to { opacity: 1; } }

    /* ════════════════════════════════════════
       DARK MODE — toggled via body.dark class
       ════════════════════════════════════════ */
    html, body { min-height: 100%; }
    body.dark { background: #0f1117 !important; color: #f0f1f3; }

    /* Layout chrome */
    body.dark header { background: #1a1d27 !important; border-bottom-color: #2e3347 !important; }
    body.dark .bottom-nav { background: #1a1d27 !important; border-top-color: #2e3347 !important; }
    body.dark #sidebar { background: #1a1d27 !important; }
    body.dark #overlay { background: rgba(0,0,0,0.65) !important; }

    /* Header text & icons */
    body.dark header span { color: #f0f1f3 !important; }
    body.dark header svg { stroke: #f0f1f3 !important; }
    body.dark #workout-timer-display { color: #f0f1f3 !important; }
    body.dark #timer-pause-btn { background: #2e3347 !important; }
    body.dark #timer-pause-btn svg { fill: #f0f1f3 !important; }

    /* Bottom nav */
    body.dark .nav-item span { color: #6b7280 !important; }
    body.dark .nav-item.active span { color: #f0f1f3 !important; }
    body.dark .nav-item svg { stroke: #6b7280 !important; }
    body.dark .nav-item.active svg { stroke: #f0f1f3 !important; }

    /* Sidebar items */
    body.dark .sidebar-nav-item { color: #9ca3af !important; }
    body.dark .sidebar-nav-item:hover { background: #252836 !important; color: #f0f1f3 !important; }
    body.dark .sidebar-nav-item.active { background: #3b4a63 !important; color: #f0f1f3 !important; }
    body.dark .sidebar-nav-item svg { stroke: #9ca3af !important; }
    body.dark .sidebar-nav-item.active svg { stroke: #f0f1f3 !important; }

    /* Main content area */
    body.dark main { background: #0f1117 !important; }
    body.dark #main-padded-wrapper { background: #0f1117 !important; }
    body.dark .tab-page { background: #0f1117 !important; }

    /* Date header */
    body.dark #dateHeader { color: #f0f1f3 !important; }
    body.dark #pageTitle { color: #f0f1f3 !important; }
    body.dark #calendar-btn svg { stroke: #9ca3af !important; }
    body.dark #settingsHeader { color: #f0f1f3 !important; }
    body.dark #settings-header-title { color: #f0f1f3 !important; }

    /* Cards — white backgrounds become dark cards */
    body.dark .exercise-card { background: #1e2130 !important; border-color: #2e3347 !important; }
    body.dark .feed-card { background: #1e2130 !important; border-color: #2e3347 !important; }
    body.dark .post-composer { background: #1e2130 !important; border-color: #2e3347 !important; }
    body.dark .routine-card { background: #1e2130 !important; border-color: #2e3347 !important; }
    body.dark .history-row { background: #252836 !important; }
    body.dark #exercise-browser { background: #1a1d27 !important; }
    body.dark #routine-builder { background: #1a1d27 !important; }

    /* Generic inline-styled white cards (Settings, Profile, etc.) */
    body.dark [style*="background:white"],
    body.dark [style*="background: white"] { background: #1e2130 !important; }

    /* Generic inline border colors */
    body.dark [style*="border:1.5px solid #e2e4e7"],
    body.dark [style*="border: 1.5px solid #e2e4e7"],
    body.dark [style*="border:1px solid #f0f1f3"],
    body.dark [style*="border: 1px solid #f0f1f3"],
    body.dark [style*="border:1px solid #e2e4e7"],
    body.dark [style*="border: 1px solid #e2e4e7"] { border-color: #2e3347 !important; }

    /* Generic inline text colors */
    body.dark [style*="color:#1a2332"],
    body.dark [style*="color: #1a2332"] { color: #f0f1f3 !important; }
    body.dark [style*="color:#374151"],
    body.dark [style*="color: #374151"] { color: #d1d5db !important; }
    body.dark [style*="color:#4b5563"],
    body.dark [style*="color: #4b5563"] { color: #9ca3af !important; }
    body.dark [style*="color:#6b7280"],
    body.dark [style*="color: #6b7280"] { color: #9ca3af !important; }

    /* Generic inline background light grey */
    body.dark [style*="background:#f0f1f3"],
    body.dark [style*="background: #f0f1f3"],
    body.dark [style*="background:#f5f6f8"],
    body.dark [style*="background: #f5f6f8"],
    body.dark [style*="background:#f9fafb"],
    body.dark [style*="background: #f9fafb"] { background: #252836 !important; }

    /* Inline border-bottom separators */
    body.dark [style*="border-bottom:1px solid #f0f1f3"],
    body.dark [style*="border-bottom: 1px solid #f0f1f3"],
    body.dark [style*="border-bottom:1px solid #e2e4e7"],
    body.dark [style*="border-bottom: 1px solid #e2e4e7"] { border-bottom-color: #2e3347 !important; }

    /* Inline top borders */
    body.dark [style*="border-top:1px solid #f0f1f3"],
    body.dark [style*="border-top: 1px solid #f0f1f3"] { border-top-color: #2e3347 !important; }

    /* Counter buttons */
    body.dark .counter-btn { background: #252836 !important; color: #f0f1f3 !important; }
    body.dark .counter-val { color: #f0f1f3 !important; }

    /* Pill buttons */
    body.dark .bp-pill { background: #252836 !important; border-color: #3b4a63 !important; color: #9ca3af !important; }
    body.dark .bp-pill.active { background: #f0f1f3 !important; color: #1a2332 !important; border-color: #f0f1f3 !important; }

    /* Exercise items */
    body.dark .ex-item { border-bottom-color: #2e3347 !important; }
    body.dark .ex-item:hover { background: #252836 !important; }
    body.dark .ex-icon { background: #2e3347 !important; }
    body.dark .ex-icon svg { stroke: #f0f1f3 !important; }
    body.dark .rb-ex-item { border-bottom-color: #2e3347 !important; }
    body.dark .rb-ex-item:hover { background: #252836 !important; }

    /* Community */
    body.dark .like-btn { background: #252836 !important; border-color: #3b4a63 !important; color: #9ca3af !important; }
    body.dark .comment-input { background: #252836 !important; color: #f0f1f3 !important; }
    body.dark .comment-input-row { border-top-color: #2e3347 !important; }
    body.dark .composer-type-btn { background: #252836 !important; border-color: #3b4a63 !important; color: #9ca3af !important; }
    body.dark .composer-type-btn.active { background: #3b4a63 !important; color: #f0f1f3 !important; }

    /* Buttons */
    body.dark .btn-secondary { background: #252836 !important; color: #f0f1f3 !important; border-color: #3b4a63 !important; }
    body.dark [style*="border:1.5px solid #d1d5db"],
    body.dark [style*="border: 1.5px solid #d1d5db"] { border-color: #4f6080 !important; }
    body.dark [style*="background:white"][style*="border"] { background: #1e2130 !important; color: #f0f1f3 !important; border-color: #4f6080 !important; }
    /* Start Exercise / secondary outline buttons */
    body.dark [style*="background:white"][style*="border-radius:16px"] { background: #252836 !important; color: #f0f1f3 !important; border-color: #4f6080 !important; }
    /* Profile tab icons (barbell, trophy) */
    body.dark #ptab-logs svg, body.dark #ptab-prs svg { stroke: #9ca3af !important; }
    body.dark #ptab-logs.active svg, body.dark #ptab-prs.active svg { stroke: #f0f1f3 !important; }
    /* Profile action buttons (Edit Profile, Share Profile) */
    body.dark .profile-action-btn { background: #252836 !important; border-color: #4f6080 !important; color: #f0f1f3 !important; }
    body.dark .profile-action-btn svg { stroke: #f0f1f3 !important; }

    /* Settings sheets */
    body.dark #settings-sheet,
    body.dark #goal-sheet,
    body.dark #meas-modal { background: #1a1d27 !important; }
    body.dark #settings-sheet-input { background: #252836 !important; border-color: #3b4a63 !important; color: #f0f1f3 !important; }

    /* Appearance toggle buttons in settings */
    body.dark #appear-light,
    body.dark #appear-system,
    body.dark #appear-dark { color: #9ca3af !important; }
    body.dark #appear-dark.selected-mode { background: #3b4a63 !important; color: #f0f1f3 !important; }

    /* Section headings in settings */
    body.dark h3 { color: #f0f1f3 !important; }
    body.dark h2 { color: #f0f1f3 !important; }
    body.dark h1 { color: #f0f1f3 !important; }

    /* SVG strokes in inline elements */
    body.dark [style*="stroke:#9ca3af"] { stroke: #6b7280 !important; }
    body.dark [style*="stroke:#1a2332"] { stroke: #f0f1f3 !important; }

    /* Scrollbar in dark mode */
    body.dark ::-webkit-scrollbar-track { background: #1a1d27; }
    body.dark ::-webkit-scrollbar-thumb { background: #3b4a63; }

    /* Sliders — accent colour in dark mode */
    body.dark input[type=range] { accent-color: #4f8ef7 !important; }

    /* Sidebar overlay — only dim, never change page content bg */
    body.dark #overlay { background: rgba(0,0,0,0.65) !important; }

    /* Chart bars in LIGHT mode — use brand blue instead of near-black */
    .chart-bar-primary { background: #2563eb !important; }
    .chart-bar-secondary { background: #93c5fd !important; }

    /* Chart bars in DARK mode — use visible blue-grey */
    body.dark .chart-bar-primary { background: #4f8ef7 !important; }
    body.dark .chart-bar-secondary { background: #3b5a8a !important; }

    /* Recent workouts icon — visible in both modes */
    .workout-icon-wrap { background: #e8edf5 !important; }
    body.dark .workout-icon-wrap { background: #2e3a52 !important; }
    .workout-icon-wrap svg { stroke: #2563eb !important; }
    body.dark .workout-icon-wrap svg { stroke: #7bb3f7 !important; }

    /* Start Exercise / New Routine buttons — visible in dark mode */
    body.dark .btn-outline-primary { background: #1e2130 !important; color: #f0f1f3 !important; border: 1.5px solid #4f6080 !important; }
    body.dark .btn-outline-primary svg { stroke: #f0f1f3 !important; }
    body.dark .btn-primary-solid { background: #f0f1f3 !important; border-color: #f0f1f3 !important; color: #1a2332 !important; }
    body.dark .btn-primary-solid svg { stroke: #1a2332 !important; }
    body.dark .btn-primary { background: #f0f1f3 !important; color: #1a2332 !important; }
    body.dark .btn-primary:hover { background: #ffffff !important; }

    /* Sidebar account footer — dark mode */
    body.dark #sidebar-account-footer { background: #1e2130 !important; border-top-color: #2e3347 !important; }
    body.dark #sidebar-profile-toggle { background: #2e3347 !important; border-radius: 14px; }
    body.dark #sidebar-profile-toggle p { color: #f0f1f3 !important; }
    body.dark #sidebar-profile-toggle:hover { background: #3b4a63 !important; }
    body.dark #account-menu { background: transparent !important; }
    body.dark #account-menu > div:first-child { background: #2e3347 !important; }

    /* Community image placeholder — should not be near-black in light mode */
    .post-img-placeholder { background: #e8edf5 !important; }
    body.dark .post-img-placeholder { background: #252836 !important; }
  </style>
</head>
<body>

<!-- ═══════════════════════════════════════════════
     HEADER
═══════════════════════════════════════════════ -->
<header style="position:fixed;top:0;left:0;right:0;z-index:50;background:white;border-bottom:1px solid #e8e9eb;">
  <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 16px;max-width:700px;margin:0 auto;">
    <!-- Left: Hamburger + FlexTab wordmark -->
    <div style="display:flex;align-items:center;gap:10px;">
      <button onclick="toggleSidebar()" style="width:36px;height:36px;border-radius:10px;background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      </button>
      <span style="font-size:18px;font-weight:800;color:#1a2332;letter-spacing:-0.5px;">FlexTab</span>
    </div>
    <!-- Right: Add button (shown on Community + Profile tabs) + Workout timer -->
    <div style="display:flex;align-items:center;gap:8px;">
      <button id="header-add-btn" onclick="openProfileActionSheet()" style="display:none;width:30px;height:30px;border-radius:50%;background:#1a2332;border:none;cursor:pointer;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s;" onmouseenter="this.style.background='#2d3f55'" onmouseleave="this.style.background='#1a2332'">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </button>
    <div id="workout-timer-wrap" style="display:none;align-items:center;gap:6px;">
      <div id="workout-timer-display" style="font-size:15px;font-weight:700;color:#1a2332;letter-spacing:0.5px;min-width:52px;text-align:right;">00:00</div>
      <!-- Pause / Resume -->
      <button id="timer-pause-btn" onclick="toggleWorkoutTimer()" title="Pause" style="width:36px;height:36px;border-radius:50%;background:#f0f1f3;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s;" onmouseenter="this.style.background='#e2e4e7'" onmouseleave="this.style.background='#f0f1f3'">
        <svg id="timer-pause-icon" width="13" height="13" viewBox="0 0 24 24" fill="#1a2332"><rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/></svg>
      </button>
      <!-- Stop / End workout -->
      <button onclick="endWorkout()" title="End workout" style="width:36px;height:36px;border-radius:50%;background:#fee2e2;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s;" onmouseenter="this.style.background='#fecaca'" onmouseleave="this.style.background='#fee2e2'">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="#ef4444"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
      </button>
    </div>
    </div><!-- end workout-timer-wrap -->
    </div><!-- end right button group -->
  </div>
</header>

<!-- ═══════════════════════════════════════════════
     SIDEBAR OVERLAY
═══════════════════════════════════════════════ -->
<div id="overlay" onclick="toggleSidebar()" style="position:fixed;inset:0;background:rgba(0,0,0,0.4);z-index:40;display:none;"></div>

<!-- ═══════════════════════════════════════════════
     SIDEBAR
═══════════════════════════════════════════════ -->
<aside id="sidebar" style="position:fixed;top:0;left:0;width:280px;height:100dvh;background:white;z-index:60;box-shadow:4px 0 24px rgba(0,0,0,0.12);display:flex;flex-direction:column;overflow-y:hidden;">

  <!-- Sidebar logo strip -->
  <div style="padding:20px 20px 16px;flex-shrink:0;">
    <div style="display:flex;align-items:center;gap:8px;">
      <img src="/FLEXTAB-LOGOII.png" alt="" style="height:22px;width:auto;" onerror="this.style.display='none'" />
      <span style="font-size:18px;font-weight:800;color:#1a2332;letter-spacing:-0.4px;">FlexTab</span>
    </div>
  </div>

  <!-- Navigation (scrollable middle) -->
  <div style="padding:0 8px 16px;flex:1;overflow-y:auto;">
    <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.08em;padding:0 12px;margin-bottom:10px;">Menu</p>
    <div style="height:1px;background:#f0f1f3;margin:0 4px 10px;"></div>

    <div class="sidebar-nav-item active" id="snav-log" onclick="setSidebarNav('log')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><line x1="14" y1="4" x2="21" y2="4"/><line x1="14" y1="9" x2="21" y2="9"/><line x1="14" y1="15" x2="21" y2="15"/><line x1="14" y1="20" x2="21" y2="20"/></svg>
      Log
    </div>
    <div class="sidebar-nav-item" id="snav-measurements" onclick="setSidebarNav('measurements')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 12h4l3-9 4 18 3-9h4"/></svg>
      Measurements
    </div>
    <div class="sidebar-nav-item" id="snav-history" onclick="setSidebarNav('history')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      History
    </div>
    <div class="sidebar-nav-item" id="snav-trends" onclick="setSidebarNav('trends')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
      Trends
    </div>
    <div class="sidebar-nav-item" id="snav-routines" onclick="setSidebarNav('routines')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      Routines
    </div>

    <div class="sidebar-nav-item" id="snav-exercises" onclick="setSidebarNav('exercises')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6.5 6.5h11"/><path d="M6.5 17.5h11"/><path d="M3 9.5h2v5H3z"/><path d="M19 9.5h2v5h-2z"/><path d="M5 12h14"/></svg>
      Exercises
    </div>

  </div>

  <!-- Account footer -->
  <div id="sidebar-account-footer" style="border-top:1px solid #f0f1f3;padding:12px;flex-shrink:0;">
    <!-- Profile block — click to toggle account options -->
    <div id="sidebar-profile-toggle" onclick="toggleAccountMenu()" style="display:flex;align-items:center;gap:12px;padding:8px;border-radius:14px;cursor:pointer;transition:background .15s;" onmouseenter="this.style.background='#f5f6f8'" onmouseleave="this.style.background='transparent'">
      <div style="width:42px;height:42px;border-radius:50%;background:#1a2332;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:white;flex-shrink:0;">JD</div>
      <div style="flex:1;min-width:0;">
        <p style="font-size:14px;font-weight:700;color:#1a2332;margin:0 0 1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">John Doe</p>
        <p style="font-size:11px;color:#9ca3af;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">john@example.com</p>
      </div>
      <svg id="account-chevron" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" style="flex-shrink:0;transition:transform .2s;"><polyline points="6 9 12 15 18 9"/></svg>
    </div>
    <!-- Collapsible account options -->
    <div id="account-menu" style="display:none;overflow:hidden;">
      <div style="height:1px;background:#f0f1f3;margin:8px 8px;"></div>

      <div class="sidebar-nav-item" style="padding:10px 12px;" onclick="openSettingsPanel()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </div>
      <div class="sidebar-nav-item" style="color:#ef4444;padding:10px 12px;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
        Sign Out
      </div>
    </div>
  </div>
</aside>

<!-- ═══════════════════════════════════════════════
     EXERCISE BROWSER (full-screen slide-up)
═══════════════════════════════════════════════ -->
<div id="exercise-browser">
  <div style="padding:16px 16px 12px;border-bottom:1px solid #f0f1f3;display:flex;align-items:center;gap:12px;flex-shrink:0;padding-top:60px;">
    <button onclick="closeBrowser()" style="width:36px;height:36px;border-radius:10px;background:#f5f6f8;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    </button>
    <div style="flex:1;position:relative;">
      <svg style="position:absolute;left:12px;top:50%;transform:translateY(-50%);" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input id="browser-search" type="text" placeholder="Search exercises…" oninput="filterExercises()" style="width:100%;padding:10px 12px 10px 36px;background:#f5f6f8;border:none;border-radius:14px;font-size:14px;color:#374151;outline:none;" />
    </div>
  </div>
  <div style="display:flex;gap:8px;padding:12px 16px;overflow-x:auto;flex-shrink:0;scrollbar-width:none;">
    <button class="bp-pill active" onclick="filterByPart('all',this)">All</button>
    <button class="bp-pill" onclick="filterByPart('chest',this)">Chest</button>
    <button class="bp-pill" onclick="filterByPart('back',this)">Back</button>
    <button class="bp-pill" onclick="filterByPart('legs',this)">Legs</button>
    <button class="bp-pill" onclick="filterByPart('arms',this)">Arms</button>
    <button class="bp-pill" onclick="filterByPart('core',this)">Core</button>
    <button class="bp-pill" onclick="filterByPart('cardio',this)">Cardio</button>
  </div>
  <div id="browser-list" style="flex:1;overflow-y:auto;"></div>
</div>

<!-- ═══════════════════════════════════════════════
     ROUTINE BUILDER (full-screen slide-up)
═══════════════════════════════════════════════ -->
<div id="routine-builder">
  <!-- Header -->
  <div style="display:flex;align-items:center;gap:12px;padding:16px;border-bottom:1px solid #f0f1f3;padding-top:60px;flex-shrink:0;">
    <button onclick="closeRoutineBuilder()" style="width:36px;height:36px;border-radius:10px;background:#f5f6f8;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
    </button>
    <div style="flex:1;">
      <h2 style="font-size:18px;font-weight:800;color:#1a2332;margin:0;">New Routine</h2>
      <p style="font-size:12px;color:#9ca3af;margin:0;">Build and save a reusable workout</p>
    </div>
    <button onclick="saveRoutine()" style="padding:9px 20px;background:#1a2332;color:white;border:none;border-radius:12px;font-size:13px;font-weight:700;cursor:pointer;flex-shrink:0;">Save</button>
  </div>

  <!-- Routine name input -->
  <div style="padding:14px 16px;border-bottom:1px solid #f0f1f3;flex-shrink:0;">
    <input id="routine-name" type="text" placeholder="Routine name (e.g. Push Day)" maxlength="40"
      style="width:100%;padding:12px 16px;background:#f5f6f8;border:none;border-radius:14px;font-size:15px;font-weight:600;color:#1a2332;outline:none;" />
  </div>

  <!-- Body part filter pills -->
  <div style="display:flex;gap:8px;padding:12px 16px;overflow-x:auto;flex-shrink:0;scrollbar-width:none;">
    <button class="bp-pill active" id="rb-pill-all" onclick="rbFilterByPart('all',this)">All</button>
    <button class="bp-pill" onclick="rbFilterByPart('chest',this)">Chest</button>
    <button class="bp-pill" onclick="rbFilterByPart('back',this)">Back</button>
    <button class="bp-pill" onclick="rbFilterByPart('legs',this)">Legs</button>
    <button class="bp-pill" onclick="rbFilterByPart('arms',this)">Arms</button>
    <button class="bp-pill" onclick="rbFilterByPart('core',this)">Core</button>
    <button class="bp-pill" onclick="rbFilterByPart('cardio',this)">Cardio</button>
  </div>

  <!-- Split: exercise picker (left) + selected list (right) -->
  <div style="flex:1;display:flex;overflow:hidden;min-height:0;">
    <!-- Left: exercise picker -->
    <div id="rb-exercise-list" style="flex:1;overflow-y:auto;border-right:1px solid #f0f1f3;"></div>
    <!-- Right: selected exercises -->
    <div style="width:150px;flex-shrink:0;display:flex;flex-direction:column;">
      <div style="padding:10px 12px;border-bottom:1px solid #f0f1f3;flex-shrink:0;">
        <p style="font-size:11px;font-weight:700;color:#9ca3af;text-transform:uppercase;letter-spacing:.07em;margin:0;">
          Selected <span id="rb-count" style="color:#1a2332;">0</span>
        </p>
      </div>
      <div id="rb-selected-list" style="flex:1;overflow-y:auto;padding:8px;"></div>
    </div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════
     MAIN CONTENT
═══════════════════════════════════════════════ -->
<main style="padding-top:68px;padding-bottom:80px;min-height:100vh;">
  <div id="main-padded-wrapper" style="max-width:700px;margin:0 auto;padding:16px;">

    <!-- Page header: date (log), page title (sidebar pages), or settings -->
    <div id="header-log" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
      <h2 id="dateHeader" style="font-size:20px;font-weight:800;color:#1a2332;margin:0;"></h2>
      <h2 id="pageTitle" style="font-size:20px;font-weight:800;color:#1a2332;margin:0;display:none;"></h2>
      <h2 id="settingsHeader" style="font-size:20px;font-weight:800;color:#1a2332;margin:0;display:none;">Settings</h2>
      <button id="calendar-btn" onclick="openCalendar()" style="width:36px;height:36px;border-radius:10px;background:transparent;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s;" onmouseenter="this.style.background='#f5f6f8'" onmouseleave="this.style.background='transparent'">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      </button>
    </div>

    <!-- Community header removed - using shared header-add-btn in navbar instead -->

    <!-- ── LOG TAB ── -->
    <div id="tab-log" class="tab-content" style="display:block;">

      <!-- Search bar -->
      <div onclick="openBrowser()" style="display:flex;align-items:center;gap:10px;background:white;border:1.5px solid #e2e4e7;border-radius:16px;padding:12px 16px;margin-bottom:14px;cursor:pointer;transition:border-color .15s;" onmouseenter="this.style.borderColor='#1a2332'" onmouseleave="this.style.borderColor='#e2e4e7'">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span style="font-size:15px;color:#9ca3af;font-weight:500;flex:1;">Search exercises…</span>
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
      </div>

      <!-- Empty state -->
      <div id="empty-state" style="background:white;border-radius:20px;border:1px solid #f0f1f3;padding:48px 24px;text-align:center;">
        <div style="display:flex;justify-content:center;margin-bottom:20px;">
          <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
            <rect x="14" y="20" width="52" height="50" rx="6" stroke="#d1d5db" stroke-width="2.5"/>
            <rect x="28" y="12" width="24" height="14" rx="4" stroke="#d1d5db" stroke-width="2.5" fill="white"/>
            <rect x="26" y="36" width="28" height="14" rx="3" stroke="#d1d5db" stroke-width="2"/>
            <line x1="26" y1="43" x2="54" y2="43" stroke="#d1d5db" stroke-width="2"/>
            <circle cx="23" cy="43" r="2.5" fill="#d1d5db"/>
            <circle cx="57" cy="43" r="2.5" fill="#d1d5db"/>
            <line x1="26" y1="58" x2="46" y2="58" stroke="#d1d5db" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <h3 style="font-size:20px;font-weight:700;color:#1a2332;margin:0 0 8px;">No exercises added yet</h3>
        <p style="color:#9ca3af;font-size:14px;margin:0 0 24px;">Search for an exercise above or start a new routine.</p>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
          <button onclick="openBrowser()" class="btn-outline-primary" style="display:inline-flex;align-items:center;gap:8px;padding:12px 20px;background:white;border:1.5px solid #e2e4e7;border-radius:16px;font-size:14px;font-weight:600;color:#1a2332;cursor:pointer;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            Start Exercise
          </button>
          <button onclick="openRoutineBuilder()" class="btn-primary-solid" style="display:inline-flex;align-items:center;gap:8px;padding:12px 20px;background:#1a2332;border:1.5px solid #1a2332;border-radius:16px;font-size:14px;font-weight:600;color:white;cursor:pointer;" data-btn="new-routine">
            <svg class="btn-primary-solid-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            New Routine
          </button>
        </div>
      </div>

      <!-- Exercise cards -->
      <div id="exercise-cards"></div>


    </div>

    <!-- MEASUREMENTS TAB -->
    <div id="tab-measurements" class="tab-content" style="display:none;">

      <!-- ── Inline slider card ── -->
      <div style="background:white;border-radius:20px;border:1px solid #f0f1f3;overflow:hidden;margin-bottom:16px;">

        <!-- Header -->
        <div style="padding:20px 20px 16px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:16px;font-weight:700;color:#1a2332;margin:0 0 4px;">Body Measurements</h3>
          <p style="font-size:13px;color:#9ca3af;margin:0;">Drag the sliders to set today's values</p>
        </div>

        <!-- Sliders -->
        <div style="padding:8px 20px 4px;">

          <!-- Weight -->
          <div style="padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:15px;color:#6b7280;font-weight:500;">Weight</span>
              <span style="font-size:28px;font-weight:800;color:#1a2332;" id="ms-weight-val">185 <span style="font-size:13px;font-weight:500;color:#9ca3af;">lbs</span></span>
            </div>
            <input type="range" id="ms-weight" min="80" max="400" step="1" value="185"
              oninput="updateMeasSlider('weight', this.value, 'lbs')"
              style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
            <div style="display:flex;justify-content:space-between;margin-top:4px;">
              <span style="font-size:11px;color:#d1d5db;">80</span>
              <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
              <span style="font-size:11px;color:#d1d5db;">400</span>
            </div>
          </div>

          <!-- Body Fat -->
          <div style="padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:15px;color:#6b7280;font-weight:500;">Body Fat</span>
              <span style="font-size:28px;font-weight:800;color:#1a2332;" id="ms-bodyfat-val">15.0 <span style="font-size:13px;font-weight:500;color:#9ca3af;">%</span></span>
            </div>
            <input type="range" id="ms-bodyfat" min="3" max="50" step="0.5" value="15"
              oninput="updateMeasSlider('bodyfat', this.value, '%')"
              style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
            <div style="display:flex;justify-content:space-between;margin-top:4px;">
              <span style="font-size:11px;color:#d1d5db;">3%</span>
              <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
              <span style="font-size:11px;color:#d1d5db;">50%</span>
            </div>
          </div>

          <!-- Chest -->
          <div style="padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:15px;color:#6b7280;font-weight:500;">Chest</span>
              <span style="font-size:28px;font-weight:800;color:#1a2332;" id="ms-chest-val">38.0 <span style="font-size:13px;font-weight:500;color:#9ca3af;">in</span></span>
            </div>
            <input type="range" id="ms-chest" min="24" max="60" step="0.5" value="38"
              oninput="updateMeasSlider('chest', this.value, 'in')"
              style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
            <div style="display:flex;justify-content:space-between;margin-top:4px;">
              <span style="font-size:11px;color:#d1d5db;">24"</span>
              <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
              <span style="font-size:11px;color:#d1d5db;">60"</span>
            </div>
          </div>

          <!-- Waist -->
          <div style="padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:15px;color:#6b7280;font-weight:500;">Waist</span>
              <span style="font-size:28px;font-weight:800;color:#1a2332;" id="ms-waist-val">32.0 <span style="font-size:13px;font-weight:500;color:#9ca3af;">in</span></span>
            </div>
            <input type="range" id="ms-waist" min="20" max="60" step="0.5" value="32"
              oninput="updateMeasSlider('waist', this.value, 'in')"
              style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
            <div style="display:flex;justify-content:space-between;margin-top:4px;">
              <span style="font-size:11px;color:#d1d5db;">20"</span>
              <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
              <span style="font-size:11px;color:#d1d5db;">60"</span>
            </div>
          </div>

          <!-- Arms -->
          <div style="padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:15px;color:#6b7280;font-weight:500;">Arms</span>
              <span style="font-size:28px;font-weight:800;color:#1a2332;" id="ms-arms-val">14.0 <span style="font-size:13px;font-weight:500;color:#9ca3af;">in</span></span>
            </div>
            <input type="range" id="ms-arms" min="8" max="30" step="0.5" value="14"
              oninput="updateMeasSlider('arms', this.value, 'in')"
              style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
            <div style="display:flex;justify-content:space-between;margin-top:4px;">
              <span style="font-size:11px;color:#d1d5db;">8"</span>
              <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
              <span style="font-size:11px;color:#d1d5db;">30"</span>
            </div>
          </div>

          <!-- Thighs -->
          <div style="padding:14px 0;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:15px;color:#6b7280;font-weight:500;">Thighs</span>
              <span style="font-size:28px;font-weight:800;color:#1a2332;" id="ms-thighs-val">22.0 <span style="font-size:13px;font-weight:500;color:#9ca3af;">in</span></span>
            </div>
            <input type="range" id="ms-thighs" min="12" max="40" step="0.5" value="22"
              oninput="updateMeasSlider('thighs', this.value, 'in')"
              style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
            <div style="display:flex;justify-content:space-between;margin-top:4px;">
              <span style="font-size:11px;color:#d1d5db;">12"</span>
              <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
              <span style="font-size:11px;color:#d1d5db;">40"</span>
            </div>
          </div>

        </div>

        <!-- Save button -->
        <div style="padding:4px 20px 20px;">
          <button class="btn-primary" onclick="saveMeasurementsInline()">Save Measurements</button>
        </div>

      </div>

      <!-- History list -->
      <div id="meas-history"></div>
    </div>

    <!-- HISTORY TAB -->
    <div id="tab-history" class="tab-content" style="display:none;">
      <div id="history-list"></div>
    </div>

    <!-- TRENDS TAB -->
    <div id="tab-trends" class="tab-content" style="display:none;">

      <!-- ── LIFETIME STATS ── -->
      <div style="background:white;border-radius:20px;border:1px solid #f0f1f3;overflow:hidden;margin-bottom:16px;">
        <div style="padding:18px 20px 14px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:15px;font-weight:700;color:#1a2332;margin:0;">Lifetime Stats</h3>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:0;">
          <div style="padding:16px 20px;border-right:1px solid #f0f1f3;border-bottom:1px solid #f0f1f3;">
            <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 6px;">Total Workouts</p>
            <p style="font-size:28px;font-weight:800;color:#1a2332;margin:0;" id="stat-workouts">0</p>
          </div>
          <div style="padding:16px 20px;border-bottom:1px solid #f0f1f3;">
            <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 6px;">Total Volume</p>
            <p style="font-size:28px;font-weight:800;color:#1a2332;margin:0;" id="stat-volume">0 <span style="font-size:13px;font-weight:500;color:#9ca3af;">lbs</span></p>
          </div>
          <div style="padding:16px 20px;border-right:1px solid #f0f1f3;">
            <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 6px;">Total Sets</p>
            <p style="font-size:28px;font-weight:800;color:#1a2332;margin:0;" id="stat-sets">0</p>
          </div>
          <div style="padding:16px 20px;">
            <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 6px;">Total Reps</p>
            <p style="font-size:28px;font-weight:800;color:#1a2332;margin:0;" id="stat-reps">0</p>
          </div>
        </div>
      </div>

      <!-- ── PERSONAL RECORDS ── -->
      <div style="background:white;border-radius:20px;border:1px solid #f0f1f3;overflow:hidden;margin-bottom:16px;">
        <div style="padding:18px 20px 14px;border-bottom:1px solid #f0f1f3;display:flex;align-items:center;gap:8px;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
          <h3 style="font-size:15px;font-weight:700;color:#1a2332;margin:0;">Personal Records</h3>
        </div>
        <div id="pr-list" style="padding:8px 0;"></div>
      </div>

      <!-- ── EXERCISE PROGRESS ── -->
      <div style="background:white;border-radius:20px;border:1px solid #f0f1f3;overflow:hidden;margin-bottom:16px;">
        <div style="padding:18px 20px 14px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:15px;font-weight:700;color:#1a2332;margin:0;">Strength Progress</h3>
          <p style="font-size:12px;color:#9ca3af;margin:4px 0 0;">Over-time volume per exercise</p>
        </div>
        <div id="exercise-progress-list" style="padding:8px 12px 12px;"></div>
      </div>

    </div>

    <!-- ROUTINES TAB -->
    <div id="tab-routines" class="tab-content" style="display:none;">
      <!-- Search bar (same style as Log tab) -->
      <div onclick="openBrowser()" style="display:flex;align-items:center;gap:10px;background:white;border:1.5px solid #e2e4e7;border-radius:16px;padding:12px 16px;margin-bottom:14px;cursor:pointer;transition:border-color .15s;" onmouseenter="this.style.borderColor='#1a2332'" onmouseleave="this.style.borderColor='#e2e4e7'">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span style="font-size:15px;color:#9ca3af;font-weight:500;flex:1;">Search exercises…</span>
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <div id="routines-section" style="display:none;"><div id="routines-list"></div></div>
      <div id="routines-empty-hint">
        <div style="background:white;border-radius:20px;border:1px solid #f0f1f3;padding:48px 24px;text-align:center;">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="1.5" stroke-linecap="round" style="margin-bottom:16px;display:block;margin-left:auto;margin-right:auto;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          <h3 style="font-size:18px;font-weight:700;color:#1a2332;margin:0 0 8px;">No routines yet</h3>
          <p style="color:#9ca3af;font-size:14px;margin:0 0 24px;">Build and save reusable workout routines to load them quickly.</p>
          <button onclick="openRoutineBuilder()" class="btn-primary-solid" style="display:inline-flex;align-items:center;gap:8px;padding:12px 24px;background:#1a2332;border:1.5px solid #1a2332;border-radius:16px;font-size:14px;font-weight:600;color:white;cursor:pointer;">
            <svg class="btn-primary-solid-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Create First Routine
          </button>
        </div>
      </div>
    </div>

    <!-- EXERCISES TAB -->
    <div id="tab-exercises" class="tab-content" style="display:none;">
      <!-- Search bar -->
      <div onclick="openBrowser()" style="display:flex;align-items:center;gap:10px;background:white;border:1.5px solid #e2e4e7;border-radius:16px;padding:12px 16px;margin-bottom:14px;cursor:pointer;transition:border-color .15s;" onmouseenter="this.style.borderColor='#1a2332'" onmouseleave="this.style.borderColor='#e2e4e7'">
        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <span style="font-size:15px;color:#9ca3af;font-weight:500;flex:1;">Search exercises…</span>
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
      <!-- Muscle group filter pills -->
      <div style="display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;margin-bottom:16px;scrollbar-width:none;">
        <button onclick="filterExerciseLib('all',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:#1a2332;border:none;font-size:13px;font-weight:600;color:white;cursor:pointer;">All</button>
        <button onclick="filterExerciseLib('chest',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Chest</button>
        <button onclick="filterExerciseLib('back',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Back</button>
        <button onclick="filterExerciseLib('legs',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Legs</button>
        <button onclick="filterExerciseLib('arms',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Arms</button>
        <button onclick="filterExerciseLib('shoulders',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Shoulders</button>
        <button onclick="filterExerciseLib('core',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Core</button>
        <button onclick="filterExerciseLib('cardio',this)" style="flex-shrink:0;padding:7px 16px;border-radius:20px;background:white;border:1.5px solid #e2e4e7;font-size:13px;font-weight:600;color:#6b7280;cursor:pointer;">Cardio</button>
      </div>
      <!-- Exercise list -->
      <div id="exercise-lib-list"></div>
    </div>

    <!-- COMMUNITY TAB -->
    <div id="tab-community" class="tab-content" style="display:none;">

      <!-- Post Composer (opens from header + button, hidden by default) -->
      <div id="post-composer" class="post-composer" style="display:none;">
        <!-- Composer type selector -->
        <div style="display:flex;gap:8px;margin-bottom:14px;">
          <button class="composer-type-btn active" id="ctype-log" onclick="setComposerType('log')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><line x1="14" y1="4" x2="21" y2="4"/><line x1="14" y1="9" x2="21" y2="9"/><line x1="14" y1="15" x2="21" y2="15"/><line x1="14" y1="20" x2="21" y2="20"/></svg>
            Workout Log
          </button>
          <button class="composer-type-btn" id="ctype-media" onclick="setComposerType('media')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            Photo / Video
          </button>
        </div>

        <!-- Workout Log composer -->
        <div id="composer-log-section">
          <textarea id="composer-caption" placeholder="Share your workout... (optional)" rows="2"
            style="width:100%;background:#f5f6f8;border:none;border-radius:14px;padding:12px 14px;font-size:14px;color:#1a2332;resize:none;outline:none;font-family:inherit;margin-bottom:10px;"></textarea>
          <!-- Auto-pull last workout toggle -->
          <div style="display:flex;align-items:center;justify-content:space-between;background:#f5f6f8;border-radius:12px;padding:10px 14px;margin-bottom:10px;">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 1px;">Include today's workout log</p>
              <p id="composer-log-preview" style="font-size:11px;color:#9ca3af;margin:0;">Loading...</p>
            </div>
            <label style="position:relative;display:inline-block;width:38px;height:22px;cursor:pointer;">
              <input type="checkbox" id="composer-include-log" checked style="opacity:0;width:0;height:0;">
              <span id="composer-toggle-track" style="position:absolute;inset:0;background:#1a2332;border-radius:11px;transition:background .2s;"></span>
              <span id="composer-toggle-thumb" style="position:absolute;top:3px;left:3px;width:16px;height:16px;background:white;border-radius:50%;transition:left .2s;"></span>
            </label>
          </div>
        </div>

        <!-- Media composer -->
        <div id="composer-media-section" style="display:none;">
          <textarea id="composer-media-caption" placeholder="Describe your set, PR, or clip..." rows="2"
            style="width:100%;background:#f5f6f8;border:none;border-radius:14px;padding:12px 14px;font-size:14px;color:#1a2332;resize:none;outline:none;font-family:inherit;margin-bottom:10px;"></textarea>
          <label for="composer-file-input" style="display:flex;align-items:center;gap:10px;background:#f5f6f8;border-radius:14px;padding:12px 14px;cursor:pointer;margin-bottom:10px;">
            <div style="width:36px;height:36px;border-radius:10px;background:#e2e4e7;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            </div>
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0;">Add photo or video</p>
              <p style="font-size:11px;color:#9ca3af;margin:0;">Tap to choose from your library</p>
            </div>
          </label>
          <input id="composer-file-input" type="file" accept="image/*,video/*" style="display:none;" onchange="previewComposerMedia(event)">
          <div id="composer-media-preview" style="display:none;border-radius:14px;overflow:hidden;margin-bottom:10px;aspect-ratio:1;background:#f0f1f3;"></div>
        </div>

        <!-- Post actions -->
        <div style="display:flex;gap:8px;">
          <button onclick="closePostComposer()" style="flex:1;padding:11px;background:white;border:1.5px solid #e2e4e7;border-radius:14px;font-size:14px;font-weight:600;color:#6b7280;cursor:pointer;">Cancel</button>
          <button onclick="submitPost()" style="flex:2;padding:11px;background:#1a2332;border:none;border-radius:14px;font-size:14px;font-weight:700;color:white;cursor:pointer;">Post</button>
        </div>
      </div>

      <!-- Feed -->
      <div id="community-feed"></div>

    </div><!-- end tab-community -->

    <!-- PROFILE TAB -->
    <div id="tab-profile" class="tab-content" style="display:none;">

      <!-- ══ COMMUNITY-CONSISTENT PROFILE LAYOUT ══ -->

      <!-- Profile info card: white rounded card on grey, matches Community feed cards -->
      <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div style="padding:18px 18px 14px;">
          <!-- Row 1: Avatar + stats -->
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px;">
            <!-- Avatar with plus badge -->
            <div style="position:relative;flex-shrink:0;">
              <div style="width:80px;height:80px;border-radius:50%;background:#1a2332;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 12px rgba(0,0,0,0.15);">
                <span style="font-size:26px;font-weight:800;color:white;">JD</span>
              </div>
              <label for="media-upload-input" style="position:absolute;bottom:2px;right:2px;width:24px;height:24px;border-radius:50%;background:#9ca3af;border:2.5px solid white;display:flex;align-items:center;justify-content:center;cursor:pointer;">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </label>
              <input id="media-upload-input" type="file" accept="image/*,video/*" multiple style="display:none;" onchange="handleMediaUpload(event)">
            </div>
            <!-- Stats -->
            <div style="flex:1;display:flex;justify-content:space-around;">
              <div style="text-align:center;">
                <p id="profile-stat-workouts" style="font-size:20px;font-weight:800;color:#1a2332;margin:0 0 2px;">0</p>
                <p style="font-size:12px;color:#6b7280;margin:0;font-weight:500;">Workouts</p>
              </div>
              <div style="text-align:center;cursor:pointer;">
                <p style="font-size:20px;font-weight:800;color:#1a2332;margin:0 0 2px;">248</p>
                <p style="font-size:12px;color:#6b7280;margin:0;font-weight:500;">Followers</p>
              </div>
              <div style="text-align:center;cursor:pointer;">
                <p style="font-size:20px;font-weight:800;color:#1a2332;margin:0 0 2px;">183</p>
                <p style="font-size:12px;color:#6b7280;margin:0;font-weight:500;">Following</p>
              </div>
            </div>
          </div>
          <!-- Row 2: Name, handle, status, bio -->
          <div style="margin-bottom:12px;">
            <h3 style="font-size:16px;font-weight:800;color:#1a2332;margin:0 0 2px;">John Doe</h3>
            <p style="font-size:13px;color:#6b7280;margin:0 0 3px;">@johndoe</p>
            <p id="profile-level-text" style="font-size:12px;color:#9ca3af;font-weight:500;margin:0 0 8px;">Beginner Lifter</p>
            <p id="profile-bio-text" style="font-size:13px;color:#4b5563;line-height:1.5;margin:0;">Passionate about strength training and building healthy habits. Logging every rep. 💪</p>
          </div>
          <!-- Row 3: Your Activity tappable row -->
          <div style="display:flex;align-items:center;justify-content:space-between;background:#f5f6f8;border-radius:12px;padding:11px 14px;margin-bottom:10px;cursor:pointer;">
            <div>
              <p style="font-size:13px;font-weight:700;color:#1a2332;margin:0 0 2px;">Your Activity</p>
              <p style="font-size:12px;color:#6b7280;margin:0;"><span id="profile-stat-volume">—</span> lifted this month</p>
            </div>
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
          <!-- Row 4: Edit Profile | Share Profile | ⋮ -->
          <div style="display:flex;gap:8px;">
            <button class="profile-action-btn" style="flex:1;padding:8px 0;background:white;border:1.5px solid #d1d5db;border-radius:10px;font-size:13px;font-weight:600;color:#1a2332;cursor:pointer;" onclick="document.getElementById('edit-profile-modal') && (document.getElementById('edit-profile-modal').style.display='flex')">Edit Profile</button>
            <button class="profile-action-btn" style="flex:1;padding:8px 0;background:white;border:1.5px solid #d1d5db;border-radius:10px;font-size:13px;font-weight:600;color:#1a2332;cursor:pointer;">Share Profile</button>
            <button class="profile-action-btn" style="width:38px;height:36px;background:white;border:1.5px solid #d1d5db;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg>
            </button>
          </div>
        </div>

        <!-- Content tab bar: inside card, separated by top border -->
        <div style="display:flex;border-top:1px solid #f0f1f3;">
          <button id="ptab-posts" onclick="switchProfileTab('posts')" style="flex:1;padding:12px 0;background:none;border:none;border-bottom:2.5px solid #1a2332;cursor:pointer;display:flex;align-items:center;justify-content:center;">
            <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          </button>
          <button id="ptab-logs" onclick="switchProfileTab('logs')" style="flex:1;padding:12px 0;background:none;border:none;border-bottom:2.5px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;">
            <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><path d="M6.5 6.5h11"/><path d="M6.5 17.5h11"/><path d="M3 9.5h2v5H3z"/><path d="M19 9.5h2v5h-2z"/><path d="M5 12h14"/></svg>
          </button>
          <button id="ptab-prs" onclick="switchProfileTab('prs')" style="flex:1;padding:12px 0;background:none;border:none;border-bottom:2.5px solid transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;">
            <svg width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2"/><path d="M18 9h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-2"/><path d="M6 2h12v10a6 6 0 0 1-12 0V2z"/><path d="M9 21h6"/><path d="M12 17v4"/></svg>
          </button>
        </div>
      </div><!-- end profile info card -->

      <!-- POSTS panel: 3-column media grid in a white rounded card -->
      <div id="profile-panel-posts" style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div id="media-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:2px;">
          <label for="media-upload-input-grid" style="aspect-ratio:1;background:#f0f1f3;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;cursor:pointer;">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            <span style="font-size:10px;color:#9ca3af;font-weight:600;">Add</span>
          </label>
          <input id="media-upload-input-grid" type="file" accept="image/*,video/*" multiple style="display:none;" onchange="handleMediaUpload(event)">
        </div>
        <div id="media-empty-state" style="display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;gap:10px;">
          <div style="width:52px;height:52px;border-radius:50%;background:#f0f1f3;display:flex;align-items:center;justify-content:center;">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
          </div>
          <p style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">No posts yet</p>
          <p style="font-size:12px;color:#9ca3af;margin:0;text-align:center;">Upload a photo or video to share your workouts</p>
        </div>
      </div>

      <!-- LOGS panel: white rounded card on grey -->
      <div id="profile-panel-logs" style="display:none;">
        <!-- Lifter Level card -->
        <div id="lifter-level-card" style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;padding:16px 18px;"></div>
        <!-- Recent Workouts card -->
        <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
          <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;display:flex;justify-content:space-between;align-items:center;">
            <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Recent Workouts</h3>
            <span style="font-size:12px;color:#6b7280;font-weight:500;cursor:pointer;">See all</span>
          </div>
          <div id="profile-recent-activity" style="padding:14px 18px;">
            <p style="font-size:13px;color:#9ca3af;text-align:center;padding:8px 0;">No recent workouts</p>
          </div>
        </div>
        <!-- Lifetime Stats card -->
        <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
          <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;">
            <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Lifetime Stats</h3>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;">
            <div style="padding:14px 18px;border-right:1px solid #f0f1f3;border-bottom:1px solid #f0f1f3;">
              <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Total Sets</p>
              <p id="profile-stat-sets" style="font-size:20px;font-weight:800;color:#1a2332;margin:0;">—</p>
            </div>
            <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;">
              <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Total Reps</p>
              <p id="profile-stat-reps" style="font-size:20px;font-weight:800;color:#1a2332;margin:0;">—</p>
            </div>
            <div style="padding:14px 18px;border-right:1px solid #f0f1f3;">
              <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Workouts</p>
              <p id="profile-stat-workouts-2" style="font-size:20px;font-weight:800;color:#1a2332;margin:0;">—</p>
            </div>
            <div style="padding:14px 18px;">
              <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Fitness Goal</p>
              <p style="font-size:15px;font-weight:700;color:#1a2332;margin:0;">Build Muscle</p>
            </div>
          </div>
        </div>
      </div>

      <!-- PRs panel: white rounded card on grey -->
      <div id="profile-panel-prs" style="display:none;margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Personal Records</h3>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid #f0f1f3;">
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:38px;height:38px;border-radius:10px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2"/><path d="M18 9h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-2"/><path d="M6 2h12v10a6 6 0 0 1-12 0V2z"/><path d="M9 21h6"/><path d="M12 17v4"/></svg>
            </div>
            <div>
              <p style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Bench Press</p>
              <p style="font-size:11px;color:#9ca3af;margin:0;">Last updated: —</p>
            </div>
          </div>
          <p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">— lbs</p>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid #f0f1f3;">
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:38px;height:38px;border-radius:10px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2"/><path d="M18 9h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-2"/><path d="M6 2h12v10a6 6 0 0 1-12 0V2z"/><path d="M9 21h6"/><path d="M12 17v4"/></svg>
            </div>
            <div>
              <p style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Squat</p>
              <p style="font-size:11px;color:#9ca3af;margin:0;">Last updated: —</p>
            </div>
          </div>
          <p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">— lbs</p>
        </div>
        <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 18px;">
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:38px;height:38px;border-radius:10px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h2"/><path d="M18 9h2a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-2"/><path d="M6 2h12v10a6 6 0 0 1-12 0V2z"/><path d="M9 21h6"/><path d="M12 17v4"/></svg>
            </div>
            <div>
              <p style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Deadlift</p>
              <p style="font-size:11px;color:#9ca3af;margin:0;">Last updated: —</p>
            </div>
          </div>
          <p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">— lbs</p>
        </div>
      </div>

  </div><!-- end tab-profile -->

  <!-- ══ SETTINGS TAB ══ -->
  <div id="tab-settings" class="tab-content" style="display:none;">
    <div style="padding:0 0 24px;">

      <!-- Account section -->
      <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Account</h3>
        </div>
        <div style="padding:0 18px;">
          <div onclick="openSettingsEdit('name','Name','text','John Doe')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;cursor:pointer;" onmouseenter="this.style.background='#f9fafb'" onmouseleave="this.style.background='transparent'">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Name</p>
              <p id="settings-val-name" style="font-size:12px;color:#9ca3af;margin:0;">John Doe</p>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
          <div onclick="openSettingsEdit('email','Email','email','john@example.com')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;cursor:pointer;" onmouseenter="this.style.background='#f9fafb'" onmouseleave="this.style.background='transparent'">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Email</p>
              <p id="settings-val-email" style="font-size:12px;color:#9ca3af;margin:0;">john@example.com</p>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
          <div onclick="openSettingsEdit('password','Password','password','')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;cursor:pointer;" onmouseenter="this.style.background='#f9fafb'" onmouseleave="this.style.background='transparent'">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Password</p>
              <p id="settings-val-password" style="font-size:12px;color:#9ca3af;margin:0;">••••••••</p>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
        </div>
      </div>

      <!-- Preferences section -->
      <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Preferences</h3>
        </div>
        <div style="padding:0 18px;">

          <!-- Appearance / Dark mode -->
          <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Appearance</p>
              <p style="font-size:12px;color:#9ca3af;margin:0;">Light, Dark, or System</p>
            </div>
            <div style="display:flex;gap:4px;background:#f0f1f3;border-radius:10px;padding:3px;">
              <button onclick="setAppearance('light')" id="appear-light" style="padding:5px 10px;border-radius:7px;border:none;font-size:11px;font-weight:600;cursor:pointer;background:#1a2332;color:white;transition:all .15s;">Light</button>
              <button onclick="setAppearance('system')" id="appear-system" style="padding:5px 10px;border-radius:7px;border:none;font-size:11px;font-weight:600;cursor:pointer;background:transparent;color:#6b7280;transition:all .15s;">System</button>
              <button onclick="setAppearance('dark')" id="appear-dark" style="padding:5px 10px;border-radius:7px;border:none;font-size:11px;font-weight:600;cursor:pointer;background:transparent;color:#6b7280;transition:all .15s;">Dark</button>
            </div>
          </div>

          <!-- Weight Unit -->
          <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Weight Unit</p>
              <p style="font-size:12px;color:#9ca3af;margin:0;">lbs or kg</p>
            </div>
            <div style="display:flex;gap:6px;">
              <button onclick="setUnit('lbs')" id="settings-unit-lbs" style="padding:5px 12px;border-radius:8px;border:1.5px solid #1a2332;background:#1a2332;color:white;font-size:12px;font-weight:600;cursor:pointer;">lbs</button>
              <button onclick="setUnit('kg')" id="settings-unit-kg" style="padding:5px 12px;border-radius:8px;border:1.5px solid #e2e4e7;background:white;color:#9ca3af;font-size:12px;font-weight:600;cursor:pointer;">kg</button>
            </div>
          </div>

          <!-- Fitness Goal -->
          <div onclick="openFitnessGoalSheet()" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;cursor:pointer;" onmouseenter="this.style.background='#f9fafb'" onmouseleave="this.style.background='transparent'">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Fitness Goal</p>
              <p id="settings-val-goal" style="font-size:12px;color:#9ca3af;margin:0;">Build Muscle</p>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>

          <!-- Notifications -->
          <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Notifications</p>
              <p style="font-size:12px;color:#9ca3af;margin:0;">Workout reminders &amp; updates</p>
            </div>
            <div onclick="this.classList.toggle('on');this.style.background=this.classList.contains('on')?'#1a2332':'#e2e4e7';this.querySelector('div').style.transform=this.classList.contains('on')?'translateX(20px)':'translateX(2px)';" style="width:44px;height:24px;border-radius:99px;background:#e2e4e7;cursor:pointer;position:relative;transition:background .2s;flex-shrink:0;">
              <div style="width:20px;height:20px;border-radius:50%;background:white;position:absolute;top:2px;left:0;transform:translateX(2px);transition:transform .2s;box-shadow:0 1px 3px rgba(0,0,0,.2);"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Privacy section -->
      <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid #f0f1f3;">
          <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Privacy</h3>
        </div>
        <div style="padding:0 18px;">
          <div onclick="openSettingsEdit('visibility','Profile Visibility','select','Public')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;cursor:pointer;" onmouseenter="this.style.background='#f9fafb'" onmouseleave="this.style.background='transparent'">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Profile Visibility</p>
              <p id="settings-val-visibility" style="font-size:12px;color:#9ca3af;margin:0;">Public</p>
            </div>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
          </div>
          <div style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;">
            <div>
              <p style="font-size:13px;font-weight:600;color:#1a2332;margin:0 0 2px;">Allow Others to Follow</p>
              <p style="font-size:12px;color:#9ca3af;margin:0;">Let others follow your progress</p>
            </div>
            <div onclick="this.classList.toggle('on');this.style.background=this.classList.contains('on')?'#1a2332':'#e2e4e7';this.querySelector('div').style.transform=this.classList.contains('on')?'translateX(20px)':'translateX(2px)';" style="width:44px;height:24px;border-radius:99px;background:#1a2332;cursor:pointer;position:relative;transition:background .2s;flex-shrink:0;" class="on">
              <div style="width:20px;height:20px;border-radius:50%;background:white;position:absolute;top:2px;left:0;transform:translateX(20px);transition:transform .2s;box-shadow:0 1px 3px rgba(0,0,0,.2);"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danger zone -->
      <div style="margin:0 0 14px;background:white;border-radius:20px;border:1.5px solid #e2e4e7;overflow:hidden;">
        <div style="padding:0 18px;">
          <div onclick="confirmSignOut()" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid #f0f1f3;cursor:pointer;" onmouseenter="this.style.background='#fff5f5'" onmouseleave="this.style.background='transparent'">
            <p style="font-size:13px;font-weight:600;color:#ef4444;margin:0;">Sign Out</p>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          </div>
          <div onclick="confirmDeleteAccount()" style="display:flex;align-items:center;justify-content:space-between;padding:14px 0;cursor:pointer;" onmouseenter="this.style.background='#fff5f5'" onmouseleave="this.style.background='transparent'">
            <p style="font-size:13px;font-weight:600;color:#ef4444;margin:0;">Delete Account</p>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
          </div>
        </div>
      </div>

    </div>
  </div><!-- end tab-settings -->

  <!-- ── Settings Edit Bottom Sheet ── -->
  <div id="settings-sheet-overlay" onclick="closeSettingsSheet()" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:200;display:none;"></div>
  <div id="settings-sheet" style="position:fixed;bottom:0;left:0;right:0;background:white;border-radius:24px 24px 0 0;z-index:201;padding:24px 20px 36px;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);max-width:700px;margin:0 auto;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
      <h3 id="settings-sheet-title" style="font-size:17px;font-weight:700;color:#1a2332;margin:0;">Edit</h3>
      <button onclick="closeSettingsSheet()" style="width:32px;height:32px;border-radius:50%;background:#f0f1f3;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <!-- Text input mode -->
    <div id="settings-sheet-input-wrap" style="margin-bottom:16px;">
      <input id="settings-sheet-input" type="text" style="width:100%;padding:14px 16px;border:1.5px solid #e2e4e7;border-radius:14px;font-size:15px;color:#1a2332;outline:none;font-family:inherit;box-sizing:border-box;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e2e4e7'" />
    </div>
    <!-- Select mode (Fitness Goal / Visibility) -->
    <div id="settings-sheet-options" style="display:none;margin-bottom:16px;"></div>
    <button onclick="saveSettingsSheet()" style="width:100%;background:#1a2332;color:white;border:none;border-radius:14px;padding:15px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;">Save</button>
  </div>

  <!-- ── Fitness Goal Sheet ── -->
  <div id="goal-sheet-overlay" onclick="closeFitnessGoalSheet()" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:200;display:none;"></div>
  <div id="goal-sheet" style="position:fixed;bottom:0;left:0;right:0;background:white;border-radius:24px 24px 0 0;z-index:201;padding:24px 20px 36px;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);max-width:700px;margin:0 auto;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
      <h3 style="font-size:17px;font-weight:700;color:#1a2332;margin:0;">Fitness Goal</h3>
      <button onclick="closeFitnessGoalSheet()" style="width:32px;height:32px;border-radius:50%;background:#f0f1f3;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div id="goal-options" style="display:flex;flex-direction:column;gap:8px;"></div>
  </div>

  </div><!-- end main-padded-wrapper -->

</main>

<!-- ═══════════════════════════════════════════════
     BOTTOM NAV
═══════════════════════════════════════════════ -->
<nav class="bottom-nav">
  <div class="nav-item active" id="nav-log" onclick="setActiveNav('log')">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><line x1="14" y1="4" x2="21" y2="4"/><line x1="14" y1="9" x2="21" y2="9"/><line x1="14" y1="15" x2="21" y2="15"/><line x1="14" y1="20" x2="21" y2="20"/></svg>
    <span style="color:#1a2332;font-weight:700;">Log</span>
  </div>
  <div class="nav-item" id="nav-community" onclick="setActiveNav('community')">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
    <span>Community</span>
  </div>
  <div class="nav-item" id="nav-profile" onclick="setActiveNav('profile')">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 3.6-7 8-7s8 3 8 7"/></svg>
    <span>Profile</span>
  </div>
</nav>

<!-- ═══════════════════════════════════════════════
     MEASUREMENTS MODAL
═══════════════════════════════════════════════ -->
<div id="meas-overlay" onclick="closeMeasurementsModal()" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:90;display:none;"></div>
<div id="meas-modal" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0.92);width:calc(100% - 32px);max-width:420px;background:white;border-radius:24px;z-index:91;padding:24px 20px;opacity:0;pointer-events:none;transition:opacity .25s,transform .25s;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
    <h3 style="font-size:16px;font-weight:700;color:#1a2332;margin:0;">Log Measurements</h3>
    <button onclick="closeMeasurementsModal()" style="width:32px;height:32px;border-radius:50%;background:#f5f6f8;border:none;cursor:pointer;font-size:16px;color:#6b7280;">✕</button>
  </div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px;">
    <div>
      <label style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px;">Weight (lbs)</label>
      <input id="m-weight" type="number" placeholder="185" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e8e9eb;font-size:16px;font-weight:700;color:#1a2332;background:#f9fafb;box-sizing:border-box;outline:none;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e8e9eb'" />
    </div>
    <div>
      <label style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px;">Body Fat (%)</label>
      <input id="m-bodyfat" type="number" step="0.1" placeholder="14.2" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e8e9eb;font-size:16px;font-weight:700;color:#1a2332;background:#f9fafb;box-sizing:border-box;outline:none;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e8e9eb'" />
    </div>
    <div>
      <label style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px;">Chest (in)</label>
      <input id="m-chest" type="number" step="0.5" placeholder="42" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e8e9eb;font-size:16px;font-weight:700;color:#1a2332;background:#f9fafb;box-sizing:border-box;outline:none;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e8e9eb'" />
    </div>
    <div>
      <label style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px;">Waist (in)</label>
      <input id="m-waist" type="number" step="0.5" placeholder="32" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e8e9eb;font-size:16px;font-weight:700;color:#1a2332;background:#f9fafb;box-sizing:border-box;outline:none;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e8e9eb'" />
    </div>
    <div>
      <label style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px;">Arms (in)</label>
      <input id="m-arms" type="number" step="0.5" placeholder="15" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e8e9eb;font-size:16px;font-weight:700;color:#1a2332;background:#f9fafb;box-sizing:border-box;outline:none;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e8e9eb'" />
    </div>
    <div>
      <label style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;display:block;margin-bottom:6px;">Thighs (in)</label>
      <input id="m-thighs" type="number" step="0.5" placeholder="24" style="width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e8e9eb;font-size:16px;font-weight:700;color:#1a2332;background:#f9fafb;box-sizing:border-box;outline:none;" onfocus="this.style.borderColor='#1a2332'" onblur="this.style.borderColor='#e8e9eb'" />
    </div>
  </div>
  <button class="btn-primary" onclick="saveMeasurements()">Save Measurements</button>
</div>

<!-- ═══════════════════════════════════════════════
     END-WORKOUT SUMMARY MODAL
═══════════════════════════════════════════════ -->
<div id="end-workout-overlay" style="position:fixed;inset:0;background:rgba(0,0,0,0.55);z-index:100;display:none;align-items:center;justify-content:center;padding:24px;">
  <div style="background:white;border-radius:24px;width:100%;max-width:380px;padding:28px 24px 24px;animation:slideIn .3s ease;">
    <!-- Header -->
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:20px;">
      <div style="width:40px;height:40px;border-radius:50%;background:#f0f1f3;display:flex;align-items:center;justify-content:center;flex-shrink:0;overflow:hidden;">
        <img src="FLEXTAB-LOGOII.png" alt="FlexTab" style="width:26px;height:26px;object-fit:contain;">
      </div>
      <div>
        <h3 style="font-size:17px;font-weight:800;color:#1a2332;margin:0 0 2px;">Workout Complete!</h3>
        <p style="font-size:13px;color:#9ca3af;margin:0;">Great work — here's your summary</p>
      </div>
    </div>
    <!-- Stats grid -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;">
      <div style="background:#f5f6f8;border-radius:14px;padding:14px;">
        <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Duration</p>
        <p id="ew-duration" style="font-size:22px;font-weight:800;color:#1a2332;margin:0;">00:00</p>
      </div>
      <div style="background:#f5f6f8;border-radius:14px;padding:14px;">
        <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Exercises</p>
        <p id="ew-exercises" style="font-size:22px;font-weight:800;color:#1a2332;margin:0;">0</p>
      </div>
      <div style="background:#f5f6f8;border-radius:14px;padding:14px;">
        <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Total Sets</p>
        <p id="ew-sets" style="font-size:22px;font-weight:800;color:#1a2332;margin:0;">0</p>
      </div>
      <div style="background:#f5f6f8;border-radius:14px;padding:14px;">
        <p style="font-size:11px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin:0 0 4px;">Volume</p>
        <p id="ew-volume" style="font-size:22px;font-weight:800;color:#1a2332;margin:0;">0 lbs</p>
      </div>
    </div>
    <!-- Actions -->
    <button onclick="goToHistory()" style="width:100%;background:#1a2332;color:white;border:none;border-radius:16px;padding:15px;font-size:15px;font-weight:700;cursor:pointer;margin-bottom:10px;">Share Full Results</button>
    <button onclick="dismissEndWorkout()" style="width:100%;background:transparent;color:#9ca3af;border:none;border-radius:16px;padding:12px;font-size:14px;font-weight:600;cursor:pointer;">Dismiss</button>
  </div>
</div>

<!-- ═══════════════════════════════════════════════
     CALENDAR POPUP
═══════════════════════════════════════════════ -->
<div id="calendar-overlay" onclick="closeCalendar()" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:90;display:none;"></div>
<div id="calendar-popup" style="position:fixed;bottom:-100%;left:50%;transform:translateX(-50%);width:calc(100% - 32px);max-width:420px;background:white;border-radius:24px 24px 0 0;z-index:91;padding:24px 20px 36px;transition:bottom .35s cubic-bezier(.4,0,.2,1);">
  <!-- Handle -->
  <div style="width:40px;height:4px;background:#e2e4e7;border-radius:4px;margin:0 auto 20px;"></div>
  <!-- Month nav -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
    <button onclick="calNav(-1)" style="width:34px;height:34px;border-radius:10px;background:#f5f6f8;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><polyline points="15 18 9 12 15 6"/></svg>
    </button>
    <span id="cal-month-label" style="font-size:16px;font-weight:700;color:#1a2332;"></span>
    <button onclick="calNav(1)" style="width:34px;height:34px;border-radius:10px;background:#f5f6f8;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
    </button>
  </div>
  <!-- Day-of-week headers -->
  <div style="display:grid;grid-template-columns:repeat(7,1fr);margin-bottom:6px;">
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">Su</div>
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">Mo</div>
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">Tu</div>
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">We</div>
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">Th</div>
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">Fr</div>
    <div style="text-align:center;font-size:11px;font-weight:700;color:#9ca3af;">Sa</div>
  </div>
  <!-- Calendar grid -->
  <div id="cal-grid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;"></div>
  <!-- Legend -->
  <div style="display:flex;align-items:center;justify-content:center;gap:20px;margin-top:18px;">
    <div style="display:flex;align-items:center;gap:6px;"><div style="width:12px;height:12px;border-radius:50%;background:#1a2332;"></div><span style="font-size:12px;color:#6b7280;font-weight:500;">Workout</span></div>
    <div style="display:flex;align-items:center;gap:6px;"><div style="width:12px;height:12px;border-radius:50%;background:#f0f1f3;border:1.5px solid #e2e4e7;"></div><span style="font-size:12px;color:#6b7280;font-weight:500;">Rest</span></div>
    <div style="display:flex;align-items:center;gap:6px;"><div style="width:12px;height:12px;border-radius:50%;background:#dbeafe;border:1.5px solid #93c5fd;"></div><span style="font-size:12px;color:#6b7280;font-weight:500;">Today</span></div>
  </div>
</div>

<!-- ═══════════════════════════════════════════════
     JAVASCRIPT
═══════════════════════════════════════════════ -->
<script>
// ── Exercise database ─────────────────────────────────────────────────────────
const EXERCISES = [
  { name:'Bench Press',        part:'chest',  weight:225, defaultReps:5  },
  { name:'Incline Bench Press',part:'chest',  weight:185, defaultReps:8  },
  { name:'Dumbbell Fly',       part:'chest',  weight:45,  defaultReps:12 },
  { name:'Cable Crossover',    part:'chest',  weight:40,  defaultReps:12 },
  { name:'Push-Up',            part:'chest',  weight:0,   defaultReps:15 },
  { name:'Chest Dip',          part:'chest',  weight:0,   defaultReps:10 },
  { name:'Deadlift',           part:'back',   weight:315, defaultReps:5  },
  { name:'Pull-Up',            part:'back',   weight:0,   defaultReps:8  },
  { name:'Barbell Row',        part:'back',   weight:185, defaultReps:6  },
  { name:'Cable Row',          part:'back',   weight:150, defaultReps:10 },
  { name:'Lat Pulldown',       part:'back',   weight:140, defaultReps:10 },
  { name:'T-Bar Row',          part:'back',   weight:135, defaultReps:8  },
  { name:'Squat',              part:'legs',   weight:275, defaultReps:5  },
  { name:'Romanian Deadlift',  part:'legs',   weight:225, defaultReps:8  },
  { name:'Leg Press',          part:'legs',   weight:360, defaultReps:10 },
  { name:'Lunges',             part:'legs',   weight:95,  defaultReps:10 },
  { name:'Leg Curl',           part:'legs',   weight:100, defaultReps:12 },
  { name:'Calf Raise',         part:'legs',   weight:135, defaultReps:15 },
  { name:'Overhead Press',     part:'arms',   weight:115, defaultReps:6  },
  { name:'Barbell Curl',       part:'arms',   weight:85,  defaultReps:10 },
  { name:'Tricep Pushdown',    part:'arms',   weight:70,  defaultReps:12 },
  { name:'Hammer Curl',        part:'arms',   weight:40,  defaultReps:12 },
  { name:'Skull Crusher',      part:'arms',   weight:75,  defaultReps:10 },
  { name:'Preacher Curl',      part:'arms',   weight:65,  defaultReps:10 },
  { name:'Plank',              part:'core',   weight:0,   defaultReps:60 },
  { name:'Crunch',             part:'core',   weight:0,   defaultReps:20 },
  { name:'Hanging Leg Raise',  part:'core',   weight:0,   defaultReps:12 },
  { name:'Cable Crunch',       part:'core',   weight:80,  defaultReps:15 },
  { name:'Russian Twist',      part:'core',   weight:25,  defaultReps:20 },
  { name:'Stationary Bike',    part:'cardio', weight:0,   defaultReps:30 },
  { name:'Treadmill Run',      part:'cardio', weight:0,   defaultReps:30 },
  { name:'Rowing Machine',     part:'cardio', weight:0,   defaultReps:20 },
  { name:'Jump Rope',          part:'cardio', weight:0,   defaultReps:5  },
  { name:'Stair Climber',      part:'cardio', weight:0,   defaultReps:20 },
];

const PART_LABELS = { chest:'Chest', back:'Back', legs:'Legs', arms:'Arms', core:'Core', cardio:'Cardio' };
const PART_ICONS = {
  chest:  `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="1.5" stroke-linecap="round"><rect x="2" y="10" width="4" height="4" rx="1"/><rect x="18" y="10" width="4" height="4" rx="1"/><line x1="6" y1="12" x2="9" y2="12"/><line x1="15" y1="12" x2="18" y2="12"/><rect x="9" y="8" width="6" height="8" rx="1"/></svg>`,
  back:   `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="1.5" stroke-linecap="round"><rect x="2" y="10" width="4" height="4" rx="1"/><rect x="18" y="10" width="4" height="4" rx="1"/><line x1="6" y1="12" x2="9" y2="12"/><line x1="15" y1="12" x2="18" y2="12"/><rect x="9" y="8" width="6" height="8" rx="1"/></svg>`,
  legs:   `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="1.5" stroke-linecap="round"><line x1="12" y1="2" x2="12" y2="22"/><path d="M8 6l4-4 4 4"/><path d="M8 18l4 4 4-4"/></svg>`,
  arms:   `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="1.5" stroke-linecap="round"><path d="M6 4l2 8-4 4 4 4 6-4 4-8-6-4z"/></svg>`,
  core:   `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="1.5" stroke-linecap="round"><circle cx="12" cy="12" r="8"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>`,
  cardio: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="1.5" stroke-linecap="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/></svg>`,
};

// ── State ─────────────────────────────────────────────────────────────────────
let exercises = [];
let exerciseData = {};
const savedRoutines = [];
let currentBrowserPart = 'all';
let rbSelectedExercises = [];
let rbCurrentPart = 'all';
let currentExerciseIndex = 0;

const now = new Date();
document.getElementById('dateHeader').textContent =
  now.toLocaleDateString('en-US', { weekday:'long', month:'long', day:'numeric' });

// ── Sidebar ───────────────────────────────────────────────────────────────────
function toggleAccountMenu() {
  const menu = document.getElementById('account-menu');
  const chevron = document.getElementById('account-chevron');
  const isOpen = menu.style.display !== 'none';
  menu.style.display = isOpen ? 'none' : 'block';
  chevron.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';
}

function toggleSidebar() {
  const s = document.getElementById('sidebar');
  const o = document.getElementById('overlay');
  const open = s.classList.toggle('open');
  o.style.display = open ? 'block' : 'none';
}

function setSidebarNav(name) {
  // Hide ALL tabs — sidebar, footer nav, and settings
  ['log','measurements','history','trends','routines','exercises','community','profile','settings'].forEach(n => {
    const snav = document.getElementById('snav-' + n);
    if (snav) snav.classList.remove('active');
    const t = document.getElementById('tab-' + n); if (t) t.style.display = 'none';
  });
  // Deactivate footer nav items
  ['log','community','profile'].forEach(n => {
    const el = document.getElementById('nav-' + n);
    if (!el) return;
    el.classList.remove('active');
    el.querySelector('svg').setAttribute('stroke','#9ca3af');
    el.querySelector('span').style.color = '#9ca3af';
    el.querySelector('span').style.fontWeight = '500';
  });
  // Activate the selected sidebar item and show its tab
  document.getElementById('snav-' + name).classList.add('active');
  document.getElementById('tab-' + name).style.display = 'block';
  // Restore log header (date + calendar)
  const logHeader = document.getElementById('header-log');
  const communityHeader = document.getElementById('header-community');
  if (logHeader) logHeader.style.display = 'flex';
  if (communityHeader) communityHeader.style.display = 'none';
  const headerAddBtn2 = document.getElementById('header-add-btn');
  if (headerAddBtn2) headerAddBtn2.style.display = 'none';
  // Set header: date for log, page title for other sidebar pages
  const PAGE_TITLES = { log: null, measurements: 'Measurements', history: 'History', trends: 'Trends', routines: 'Routines', exercises: 'Exercises' };
  const dh = document.getElementById('dateHeader');
  const pt = document.getElementById('pageTitle');
  const sh = document.getElementById('settingsHeader');
  const cb = document.getElementById('calendar-btn');
  if (name === 'log') {
    if (dh) dh.style.display = 'block';
    if (pt) pt.style.display = 'none';
    if (sh) sh.style.display = 'none';
    if (cb) cb.style.display = 'flex';
  } else {
    if (dh) dh.style.display = 'none';
    if (pt) { pt.textContent = PAGE_TITLES[name] || name.charAt(0).toUpperCase() + name.slice(1); pt.style.display = 'block'; }
    if (sh) sh.style.display = 'none';
    if (cb) cb.style.display = 'none';
  }
  if (name === 'measurements') {
    renderMeasurementsPage();
    // Re-apply button theming since the page was just made visible
    const isDarkNow = document.body.classList.contains('dark');
    document.querySelectorAll('#tab-measurements .btn-primary').forEach(btn => {
      btn.style.setProperty('background', isDarkNow ? '#f0f1f3' : '#1a2332', 'important');
      btn.style.setProperty('color', isDarkNow ? '#1a2332' : 'white', 'important');
    });
  }
  if (name === 'trends') renderTrendsPage();
  if (name === 'history') renderHistoryPage();
  if (name === 'exercises') renderExerciseLib();
  toggleSidebar();
}

// ── Bottom nav ────────────────────────────────────────────────────────────────
function setActiveNav(name) {
  ['log','community','profile'].forEach(n => {
    const el = document.getElementById('nav-' + n);
    if (!el) return;
    el.classList.remove('active');
    el.querySelector('svg').setAttribute('stroke','#9ca3af');
    el.querySelector('span').style.color = '#9ca3af';
    el.querySelector('span').style.fontWeight = '500';
  });
  // Hide ALL tabs (sidebar + bottom nav) before showing the active one
  ['tab-log','tab-measurements','tab-history','tab-trends','tab-routines','tab-exercises','tab-community','tab-profile','tab-settings'].forEach(id => {
    const t = document.getElementById(id);
    if (t) t.style.display = 'none';
  });
  // Restore date header and calendar button, hide page title
  const dh2 = document.getElementById('dateHeader'); if (dh2) dh2.style.display = name === 'log' ? 'block' : 'none';
  const pt2 = document.getElementById('pageTitle'); if (pt2) pt2.style.display = 'none';
  const sh2 = document.getElementById('settingsHeader'); if (sh2) sh2.style.display = 'none';
  const cb2 = document.getElementById('calendar-btn'); if (cb2) cb2.style.display = name === 'log' ? 'flex' : 'none';
  // Swap header: show add button on community + profile, log header on log tab
  const logHeader = document.getElementById('header-log');
  const headerAddBtn = document.getElementById('header-add-btn');
  if (name === 'community' || name === 'profile') {
    if (logHeader) logHeader.style.display = 'none';
    if (headerAddBtn) headerAddBtn.style.display = 'flex';
  } else {
    if (logHeader) logHeader.style.display = 'flex';
    if (headerAddBtn) headerAddBtn.style.display = 'none';
  }
  const a = document.getElementById('nav-' + name);
  if (a) {
    a.classList.add('active');
    a.querySelector('svg').setAttribute('stroke','#1a2332');
    a.querySelector('span').style.color = '#1a2332';
    a.querySelector('span').style.fontWeight = '700';
  }
  const tab = document.getElementById('tab-' + name);
  if (tab) tab.style.display = 'block';
  if (name === 'profile') { renderProfilePage(); switchProfileTab('posts'); }
  if (name === 'community') renderCommunityFeed();
}

// ── Exercise Browser ──────────────────────────────────────────────────────────
function openBrowser() {
  document.getElementById('exercise-browser').classList.add('open');
  document.getElementById('browser-search').value = '';
  currentBrowserPart = 'all';
  document.querySelectorAll('#exercise-browser .bp-pill').forEach((p,i) => p.classList.toggle('active', i===0));
  renderBrowserList(EXERCISES);
}
function closeBrowser() { document.getElementById('exercise-browser').classList.remove('open'); }

function filterByPart(part, btn) {
  currentBrowserPart = part;
  document.querySelectorAll('#exercise-browser .bp-pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  applyBrowserFilters();
}
function filterExercises() { applyBrowserFilters(); }
function applyBrowserFilters() {
  const q = document.getElementById('browser-search').value.toLowerCase().trim();
  let list = EXERCISES;
  if (currentBrowserPart !== 'all') list = list.filter(e => e.part === currentBrowserPart);
  if (q) list = list.filter(e => e.name.toLowerCase().includes(q));
  renderBrowserList(list);
}

function renderBrowserList(list) {
  const groups = {};
  list.forEach(e => { if (!groups[e.part]) groups[e.part] = []; groups[e.part].push(e); });
  const container = document.getElementById('browser-list');
  if (list.length === 0) {
    container.innerHTML = `<div style="text-align:center;padding:48px 24px;color:#9ca3af;font-size:14px;">No exercises found</div>`;
    return;
  }
  container.innerHTML = Object.keys(groups).map(part => `
    <div>
      <div style="padding:12px 16px 6px;display:flex;align-items:center;gap:8px;">
        <div style="width:28px;height:28px;background:#f5f6f8;border-radius:8px;display:flex;align-items:center;justify-content:center;">${PART_ICONS[part]||''}</div>
        <span style="font-size:12px;font-weight:700;color:#6b7280;text-transform:uppercase;letter-spacing:.07em;">${PART_LABELS[part]||part}</span>
      </div>
      ${groups[part].map(ex => {
        const added = !!exercises.find(e => e.name === ex.name);
        return `
        <div class="ex-item" onclick="addExercise('${ex.name}','${ex.part}',${ex.weight},${ex.defaultReps})">
          <div class="ex-icon">${PART_ICONS[ex.part]||''}</div>
          <div style="flex:1;">
            <p style="font-weight:600;font-size:14px;color:#1a2332;margin:0 0 2px;">${ex.name}</p>
            <p style="font-size:12px;color:#9ca3af;margin:0;">${PART_LABELS[ex.part]} ${ex.weight > 0 ? '· ' + ex.weight + ' lbs' : ''}</p>
          </div>
          ${added
            ? `<span style="font-size:11px;font-weight:700;color:#059669;background:#f0fdf4;padding:3px 10px;border-radius:20px;">Added</span>`
            : `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>`}
        </div>`;
      }).join('')}
    </div>
  `).join('');
}

function addExercise(name, part, weight, defaultReps) {
  if (!exercises.find(e => e.name === name)) {
    exercises.push({ name, part });
    exerciseData[name] = { sets: 1, reps: defaultReps, weight, isCardio: part === 'cardio' };
    currentExerciseIndex = exercises.length - 1; // jump to newly added card
    renderExercises();
    startWorkoutTimer(); // auto-start timer on first exercise added
  }
  applyBrowserFilters();
  closeBrowser();
}

// ── Routine Builder ───────────────────────────────────────────────────────────
function openRoutineBuilder() {
  rbSelectedExercises = [];
  rbCurrentPart = 'all';
  document.getElementById('routine-name').value = '';
  document.getElementById('rb-count').textContent = '0';
  document.querySelectorAll('#routine-builder .bp-pill').forEach((p,i) => p.classList.toggle('active', i===0));
  renderRBList();
  renderRBSelected();
  document.getElementById('routine-builder').classList.add('open');
}

function closeRoutineBuilder() {
  document.getElementById('routine-builder').classList.remove('open');
}

function rbFilterByPart(part, btn) {
  rbCurrentPart = part;
  document.querySelectorAll('#routine-builder .bp-pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  renderRBList();
}

function rbToggleExercise(name, part, weight, defaultReps) {
  const idx = rbSelectedExercises.findIndex(e => e.name === name);
  if (idx > -1) {
    rbSelectedExercises.splice(idx, 1);
  } else {
    rbSelectedExercises.push({ name, part, weight, defaultReps });
  }
  document.getElementById('rb-count').textContent = rbSelectedExercises.length;
  renderRBList();
  renderRBSelected();
}

function renderRBList() {
  let list = EXERCISES;
  if (rbCurrentPart !== 'all') list = list.filter(e => e.part === rbCurrentPart);
  const container = document.getElementById('rb-exercise-list');
  container.innerHTML = list.map(ex => {
    const sel = !!rbSelectedExercises.find(e => e.name === ex.name);
    return `
    <div class="rb-ex-item ${sel ? 'selected' : ''}" onclick="rbToggleExercise('${ex.name}','${ex.part}',${ex.weight},${ex.defaultReps})">
      <div style="width:32px;height:32px;background:${sel ? 'rgba(255,255,255,0.15)' : '#f5f6f8'};border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .15s;">
        ${sel
          ? `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>`
          : PART_ICONS[ex.part]}
      </div>
      <div style="flex:1;min-width:0;">
        <p style="font-weight:600;font-size:13px;color:${sel ? '#ffffff' : '#1a2332'};margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${ex.name}</p>
        <p style="font-size:11px;color:${sel ? 'rgba(255,255,255,0.65)' : '#9ca3af'};margin:0;">${PART_LABELS[ex.part]}</p>
      </div>
    </div>`;
  }).join('');
}

function renderRBSelected() {
  const container = document.getElementById('rb-selected-list');
  if (rbSelectedExercises.length === 0) {
    container.innerHTML = `<p style="font-size:12px;color:#d1d5db;text-align:center;padding:16px 4px;line-height:1.5;">Tap exercises to add them</p>`;
    return;
  }
  container.innerHTML = rbSelectedExercises.map((ex, i) => `
    <div style="display:flex;align-items:center;gap:6px;padding:6px 4px;border-bottom:1px solid #f5f6f8;">
      <span style="font-size:11px;font-weight:700;color:#9ca3af;width:16px;flex-shrink:0;">${i+1}.</span>
      <span style="font-size:12px;font-weight:600;color:#1a2332;flex:1;line-height:1.3;">${ex.name}</span>
      <button onclick="rbToggleExercise('${ex.name}','${ex.part}',${ex.weight},${ex.defaultReps})" style="background:none;border:none;cursor:pointer;padding:2px;flex-shrink:0;">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
      </button>
    </div>
  `).join('');
}

function saveRoutine() {
  const name = document.getElementById('routine-name').value.trim() || 'My Routine';
  if (rbSelectedExercises.length === 0) {
    document.getElementById('routine-name').style.border = '2px solid #ef4444';
    document.getElementById('routine-name').placeholder = 'Select at least one exercise!';
    setTimeout(() => {
      document.getElementById('routine-name').style.border = 'none';
      document.getElementById('routine-name').placeholder = 'Routine name (e.g. Push Day)';
    }, 2000);
    return;
  }
  savedRoutines.push({ name, exercises: [...rbSelectedExercises] });
  closeRoutineBuilder();
  renderRoutines();
}

function renderRoutines() {
  const section = document.getElementById('routines-section');
  const list = document.getElementById('routines-list');
  const hint = document.getElementById('routines-empty-hint');
  if (savedRoutines.length === 0) { section.style.display = 'none'; if(hint) hint.style.display = 'block'; return; }
  if(hint) hint.style.display = 'none';
  section.style.display = 'block';
  list.innerHTML = savedRoutines.map((r, i) => `
    <div class="routine-card" onclick="loadRoutine(${i})">
      <div style="width:40px;height:40px;background:#f5f6f8;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
      </div>
      <div style="flex:1;min-width:0;">
        <p style="font-weight:700;font-size:14px;color:#1a2332;margin:0 0 2px;">${r.name}</p>
        <p style="font-size:12px;color:#9ca3af;margin:0;">${r.exercises.length} exercise${r.exercises.length !== 1 ? 's' : ''}</p>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <button onclick="event.stopPropagation();deleteRoutine(${i})" style="background:none;border:none;cursor:pointer;padding:4px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/></svg>
        </button>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
      </div>
    </div>
  `).join('');
}

function loadRoutine(idx) {
  const routine = savedRoutines[idx];
  routine.exercises.forEach(ex => {
    if (!exercises.find(e => e.name === ex.name)) {
      exercises.push({ name: ex.name, part: ex.part });
      exerciseData[ex.name] = { sets: 1, reps: ex.defaultReps, weight: ex.weight, isCardio: ex.part === 'cardio' };
    }
  });
  renderExercises();
  startWorkoutTimer(); // auto-start timer when routine is loaded
  // Switch to Log tab
  setSidebarNav('log');
  // Re-open sidebar is already closed by setSidebarNav; just show log
  ['log','measurements','history','trends','routines','exercises'].forEach(n => {
    document.getElementById('snav-' + n).classList.remove('active');
    const t = document.getElementById('tab-' + n); if (t) t.style.display = 'none';
  });
  document.getElementById('snav-log').classList.add('active');
  document.getElementById('tab-log').style.display = 'block';
}

function deleteRoutine(idx) {
  savedRoutines.splice(idx, 1);
  renderRoutines();
}

// ── Render exercise cards (single-card flip navigation) ───────────────────────
function renderExercises() {
  const container = document.getElementById('exercise-cards');
  const emptyState = document.getElementById('empty-state');
  emptyState.style.display = exercises.length === 0 ? 'block' : 'none';
  if (exercises.length === 0) { container.innerHTML = ''; return; }

  // Clamp index
  if (currentExerciseIndex >= exercises.length) currentExerciseIndex = exercises.length - 1;
  if (currentExerciseIndex < 0) currentExerciseIndex = 0;

  const ex = exercises[currentExerciseIndex];
  const d = exerciseData[ex.name];
  const key = ex.name.replace(/\s/g,'_');
  const partLabel = PART_LABELS[ex.part] || ex.part;
  const total = exercises.length;
  const idx = currentExerciseIndex;

  const sparkH = [20,28,35,42,50,58,66,75,88,100];
  const bars = sparkH.map(h => `<div style="flex:1;background:#1a2332;border-radius:2px;height:${h}%;opacity:${0.1+h/130}"></div>`).join('');

  // Progress dots (only show when >1 exercise)
  const dots = total > 1 ? `
    <div style="display:flex;justify-content:center;gap:6px;margin-bottom:12px;">
      ${exercises.map((_,i) => `<div style="width:${i===idx?20:7}px;height:7px;border-radius:4px;background:${i===idx?'#1a2332':'#d1d5db'};transition:width .2s;"></div>`).join('')}
    </div>` : '';

  container.innerHTML = `
  <div class="exercise-card" id="card-${key}">
    <!-- Header row: name left, badge right -->
    <div style="display:flex;align-items:center;justify-content:space-between;padding:18px 20px 12px;">
      <h3 style="font-size:20px;font-weight:800;color:#1a2332;margin:0;">${ex.name}</h3>
      <span style="padding:4px 12px;background:#374151;color:white;font-size:11px;font-weight:700;border-radius:20px;">${partLabel}</span>
    </div>
    ${dots}
    <!-- Stat card -->
    <div style="margin:0 16px 14px;background:#f5f6f8;border-radius:14px;padding:14px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
        <span style="font-size:13px;font-weight:700;color:#1a2332;">${ex.name}</span>
        <span style="font-size:12px;font-weight:700;color:#059669;">+4.2%</span>
      </div>
      <div style="display:flex;align-items:flex-end;justify-content:space-between;">
        <div>
          ${d.weight > 0
            ? `<p style="font-size:12px;color:#9ca3af;margin:0 0 2px;">Last: <strong style="color:#1a2332;">${d.weight} x ${d.reps}</strong></p>
               <p style="font-size:12px;color:#9ca3af;margin:0 0 2px;">Best: <strong style="color:#1a2332;">${d.weight+30} x 3</strong></p>
               <p style="font-size:12px;color:#9ca3af;margin:0;">30d Vol: <strong style="color:#1a2332;">${(d.sets*d.reps*d.weight*8).toLocaleString()} lbs</strong></p>`
            : `<p style="font-size:12px;color:#9ca3af;margin:0 0 2px;">Duration: <strong style="color:#1a2332;">-</strong></p>`}
        </div>
        <div style="display:flex;align-items:flex-end;gap:3px;height:48px;width:90px;">${bars}</div>
      </div>
    </div>
    <!-- Counters -->
    <div style="padding:0 20px;">
      <div class="counter-row">
        <span style="font-size:15px;color:#6b7280;font-weight:500;">Sets</span>
        <div style="display:flex;align-items:center;gap:16px;">
          <button class="counter-btn" onclick="adjust('${ex.name}','sets',-1)">-</button>
          <span class="counter-val" id="${key}-sets">${d.sets}</span>
          <button class="counter-btn" onclick="adjust('${ex.name}','sets',1)">+</button>
        </div>
      </div>
      <div class="counter-row">
        <span style="font-size:15px;color:#6b7280;font-weight:500;">${d.isCardio ? 'Duration (min)' : 'Reps'}</span>
        <div style="display:flex;align-items:center;gap:16px;">
          <button class="counter-btn" onclick="adjust('${ex.name}','reps',-1)">-</button>
          <span class="counter-val" id="${key}-reps">${d.reps}</span>
          <button class="counter-btn" onclick="adjust('${ex.name}','reps',1)">+</button>
        </div>
      </div>
      ${d.weight > 0 ? `
      <div class="counter-row" style="border-bottom:none;">
        <span style="font-size:15px;color:#6b7280;font-weight:500;">Weight (lbs)</span>
        <span class="counter-val" id="${key}-weight" style="font-size:28px;">${d.weight}</span>
      </div>
      <div style="padding:8px 0 14px;">
        <input type="range" min="0" max="600" step="5" value="${d.weight}"
          oninput="updateWeight('${ex.name}', this.value)"
          style="width:100%;accent-color:#1a2332;height:6px;cursor:pointer;" />
        <div style="display:flex;justify-content:space-between;margin-top:4px;">
          <span style="font-size:11px;color:#d1d5db;">0</span>
          <span style="font-size:11px;color:#9ca3af;">drag to adjust</span>
          <span style="font-size:11px;color:#d1d5db;">600</span>
        </div>
      </div>` : ''}
    </div>
    <!-- Bottom actions -->
    <div style="padding:4px 16px 20px;">
      <button class="btn-primary" id="log-btn-${key}" onclick="logSet('${ex.name}')">
        ${d.isCardio ? 'Log Ride' : 'Log Set'}
      </button>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-top:10px;">
        <button onclick="removeExercise('${ex.name}')" style="background:none;border:none;color:#ef4444;font-size:14px;font-weight:600;cursor:pointer;padding:6px 0;">
          Remove Exercise
        </button>
        <button onclick="nextExercise()" style="display:flex;align-items:center;gap:6px;background:none;border:none;color:#1a2332;font-size:14px;font-weight:600;cursor:pointer;padding:6px 0;">
          Next Exercise
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="9 18 15 12 9 6"/></svg>
        </button>
      </div>
    </div>
  </div>`;
}

// ── Navigate between exercise cards ──────────────────────────────────────────
function nextExercise() {
  if (exercises.length === 0) return;
  if (currentExerciseIndex < exercises.length - 1) {
    currentExerciseIndex++;
    renderExercises();
  } else {
    // On last exercise: open browser to add another
    openBrowser();
  }
}

// ── Adjust counters ───────────────────────────────────────────────────────────
function adjust(name, field, delta) {
  const d = exerciseData[name];
  d[field] = Math.max(1, d[field] + delta);
  const key = name.replace(/\s/g,'_');
  const el = document.getElementById(`${key}-${field}`);
  if (el) el.textContent = d[field];
}

function updateWeight(name, val) {
  const d = exerciseData[name];
  d.weight = parseInt(val);
  const key = name.replace(/\s/g,'_');
  const el = document.getElementById(`${key}-weight`);
  if (el) el.textContent = d.weight;
}

// ── Log Set ───────────────────────────────────────────────────────────────────
// ─── Workout log persistence ───
let workoutLog = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');

function logSet(name) {
  const btn = document.querySelector(`[onclick="logSet('${name}')"]`);
  if (!btn) return;
  const d = exerciseData[name];
  if (d) {
    const entry = {
      name,
      date: new Date().toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'}),
      ts: Date.now(),
      sets: d.sets,
      reps: d.reps,
      weight: d.weight,
      isCardio: !!d.isCardio,
    };
    workoutLog.push(entry);
    localStorage.setItem('flextab_workoutlog', JSON.stringify(workoutLog));
  }
  const orig = btn.textContent.trim();
  btn.textContent = '✓ Logged!';
  btn.style.background = '#059669';
  setTimeout(() => { btn.textContent = orig; btn.style.background = '#1a2332'; }, 1200);
}

// ── Remove Exercise ───────────────────────────────────────────────────────────
function removeExercise(name) {
  const idx = exercises.findIndex(e => e.name === name);
  if (idx > -1) exercises.splice(idx, 1);
  delete exerciseData[name];
  renderExercises();
}

// ── Calendar ──────────────────────────────────────────────────────────────────
// Simulate some workout days (Mon/Wed/Fri/Sat pattern for demo)
const today = new Date();
let calYear = today.getFullYear();
let calMonth = today.getMonth();

// Generate demo workout days for the current and adjacent months
function isWorkoutDay(y, m, d) {
  const dow = new Date(y, m, d).getDay(); // 0=Sun
  // Workout on Mon(1), Wed(3), Fri(5), Sat(6) — but only past days up to today
  const dt = new Date(y, m, d);
  if (dt > today) return false;
  return [1, 3, 5, 6].includes(dow);
}

// ─── MEASUREMENTS MODAL ───
let measurementsLog = JSON.parse(localStorage.getItem('flextab_measurements') || '[]');

function openMeasurementsModal() {
  ['m-weight','m-bodyfat','m-chest','m-waist','m-arms','m-thighs'].forEach(id => {
    document.getElementById(id).value = '';
  });
  const overlay = document.getElementById('meas-overlay');
  const modal   = document.getElementById('meas-modal');
  overlay.style.display = 'block';
  modal.style.pointerEvents = 'auto';
  requestAnimationFrame(() => {
    modal.style.opacity = '1';
    modal.style.transform = 'translate(-50%,-50%) scale(1)';
  });
}

function closeMeasurementsModal() {
  const overlay = document.getElementById('meas-overlay');
  const modal   = document.getElementById('meas-modal');
  modal.style.opacity = '0';
  modal.style.transform = 'translate(-50%,-50%) scale(0.92)';
  modal.style.pointerEvents = 'none';
  setTimeout(() => { overlay.style.display = 'none'; }, 250);
}

function saveMeasurements() {
  const entry = {
    date: new Date().toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'}),
    weight:  document.getElementById('m-weight').value  || null,
    bodyfat: document.getElementById('m-bodyfat').value || null,
    chest:   document.getElementById('m-chest').value   || null,
    waist:   document.getElementById('m-waist').value   || null,
    arms:    document.getElementById('m-arms').value    || null,
    thighs:  document.getElementById('m-thighs').value  || null,
  };
  const hasValue = Object.values(entry).slice(1).some(v => v !== null && v !== '');
  if (!hasValue) { alert('Please enter at least one measurement.'); return; }
  measurementsLog.unshift(entry);
  localStorage.setItem('flextab_measurements', JSON.stringify(measurementsLog));
  closeMeasurementsModal();
  renderMeasurementsPage();
}

function renderMeasurementsPage() {
  const container = document.getElementById('meas-history');
  if (!container) return;
  const fields = [
    {key:'weight',  label:'Weight',   unit:'lbs'},
    {key:'bodyfat', label:'Body Fat', unit:'%'},
    {key:'chest',   label:'Chest',    unit:'in'},
    {key:'waist',   label:'Waist',    unit:'in'},
    {key:'arms',    label:'Arms',     unit:'in'},
    {key:'thighs',  label:'Thighs',   unit:'in'},
  ];
  if (measurementsLog.length === 0) {
    container.innerHTML = `<div style="text-align:center;padding:48px 0 24px;"><div style="width:64px;height:64px;background:#f0f1f3;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round"><path d="M3 12h18M3 6h18M3 18h18"/></svg></div><p style="font-size:14px;color:#9ca3af;margin:0;">No measurements logged yet</p></div>`;
    return;
  }
  container.innerHTML = measurementsLog.map(entry => {
    const chips = fields.filter(f => entry[f.key]).map(f =>
      `<div style="background:#f0f1f3;border-radius:10px;padding:8px 12px;"><div style="font-size:10px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.06em;margin-bottom:2px;">${f.label}</div><div style="font-size:16px;font-weight:700;color:#1a2332;">${entry[f.key]}<span style="font-size:11px;font-weight:500;color:#9ca3af;margin-left:2px;">${f.unit}</span></div></div>`
    ).join('');
    return `<div style="background:white;border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.06);"><div style="font-size:12px;font-weight:600;color:#9ca3af;margin-bottom:12px;">${entry.date}</div><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">${chips}</div></div>`;
  }).join('');
}
function updateMeasSlider(field, value, unit) {
  const valEl = document.getElementById('ms-' + field + '-val');
  if (!valEl) return;
  const num = parseFloat(value);
  const display = Number.isInteger(num) ? num.toString() : num.toFixed(1);
  valEl.innerHTML = display + ' <span style="font-size:13px;font-weight:500;color:#9ca3af;">' + unit + '</span>';
}

function saveMeasurementsInline() {
  const fields = [
    {key:'weight',  id:'ms-weight',  unit:'lbs'},
    {key:'bodyfat', id:'ms-bodyfat', unit:'%'},
    {key:'chest',   id:'ms-chest',   unit:'in'},
    {key:'waist',   id:'ms-waist',   unit:'in'},
    {key:'arms',    id:'ms-arms',    unit:'in'},
    {key:'thighs',  id:'ms-thighs',  unit:'in'},
  ];
  const entry = {
    date: new Date().toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'}),
  };
  fields.forEach(f => {
    const el = document.getElementById(f.id);
    entry[f.key] = el ? el.value : null;
  });
  measurementsLog.unshift(entry);
  localStorage.setItem('flextab_measurements', JSON.stringify(measurementsLog));
  renderMeasurementsPage();
  // Flash save button as confirmation
  const btn = document.querySelector('#tab-measurements .btn-primary');
  if (btn) {
    const orig = btn.textContent;
    btn.textContent = 'Saved!';
    btn.style.background = '#16a34a';
    setTimeout(() => { btn.textContent = orig; btn.style.background = '#1a2332'; }, 1500);
  }
}
// ─── END MEASUREMENTS ───

// ─── TRENDS PAGE ───────────────────────────────────────────────────────────────
// ── Exercise Library ────────────────────────────────────────────────────────
const EXERCISE_LIB = [
  {name:'Bench Press',muscle:'chest',equipment:'Barbell',type:'Strength'},
  {name:'Incline Dumbbell Press',muscle:'chest',equipment:'Dumbbell',type:'Strength'},
  {name:'Cable Fly',muscle:'chest',equipment:'Cable',type:'Strength'},
  {name:'Push-Up',muscle:'chest',equipment:'Bodyweight',type:'Strength'},
  {name:'Pull-Up',muscle:'back',equipment:'Bodyweight',type:'Strength'},
  {name:'Barbell Row',muscle:'back',equipment:'Barbell',type:'Strength'},
  {name:'Lat Pulldown',muscle:'back',equipment:'Cable',type:'Strength'},
  {name:'Seated Cable Row',muscle:'back',equipment:'Cable',type:'Strength'},
  {name:'Squat',muscle:'legs',equipment:'Barbell',type:'Strength'},
  {name:'Romanian Deadlift',muscle:'legs',equipment:'Barbell',type:'Strength'},
  {name:'Leg Press',muscle:'legs',equipment:'Machine',type:'Strength'},
  {name:'Leg Curl',muscle:'legs',equipment:'Machine',type:'Strength'},
  {name:'Deadlift',muscle:'back',equipment:'Barbell',type:'Strength'},
  {name:'Bicep Curl',muscle:'arms',equipment:'Dumbbell',type:'Strength'},
  {name:'Tricep Pushdown',muscle:'arms',equipment:'Cable',type:'Strength'},
  {name:'Hammer Curl',muscle:'arms',equipment:'Dumbbell',type:'Strength'},
  {name:'Skull Crusher',muscle:'arms',equipment:'Barbell',type:'Strength'},
  {name:'Overhead Press',muscle:'shoulders',equipment:'Barbell',type:'Strength'},
  {name:'Lateral Raise',muscle:'shoulders',equipment:'Dumbbell',type:'Strength'},
  {name:'Front Raise',muscle:'shoulders',equipment:'Dumbbell',type:'Strength'},
  {name:'Face Pull',muscle:'shoulders',equipment:'Cable',type:'Strength'},
  {name:'Plank',muscle:'core',equipment:'Bodyweight',type:'Strength'},
  {name:'Crunch',muscle:'core',equipment:'Bodyweight',type:'Strength'},
  {name:'Russian Twist',muscle:'core',equipment:'Bodyweight',type:'Strength'},
  {name:'Treadmill',muscle:'cardio',equipment:'Machine',type:'Cardio'},
  {name:'Cycling',muscle:'cardio',equipment:'Machine',type:'Cardio'},
  {name:'Jump Rope',muscle:'cardio',equipment:'Bodyweight',type:'Cardio'},
];

let currentExerciseFilter = 'all';

function renderExerciseLib(filter) {
  filter = filter || currentExerciseFilter;
  const list = document.getElementById('exercise-lib-list');
  if (!list) return;
  const isDark = document.body.classList.contains('dark');
  const cardBg = isDark ? '#252836' : 'white';
  const cardBorder = isDark ? '1.5px solid #2e3347' : '1.5px solid #e2e4e7';
  const iconBg = isDark ? '#2e3347' : '#f5f6f8';
  const iconStroke = isDark ? '#f0f1f3' : '#1a2332';
  const nameColor = isDark ? '#f0f1f3' : '#1a2332';
  const badgeBg = isDark ? '#2e3347' : '#f5f6f8';
  const badgeColor = isDark ? '#9ca3af' : '#6b7280';
  const filtered = filter === 'all' ? EXERCISE_LIB : EXERCISE_LIB.filter(e => e.muscle === filter);
  if (!filtered.length) { list.innerHTML = '<p style="color:#9ca3af;text-align:center;padding:40px 0;">No exercises found.</p>'; return; }
  list.innerHTML = filtered.map(e => `
    <div style="display:flex;align-items:center;justify-content:space-between;background:${cardBg};border-radius:16px;border:${cardBorder};padding:14px 16px;margin-bottom:10px;">
      <div style="display:flex;align-items:center;gap:12px;">
        <div style="width:40px;height:40px;border-radius:12px;background:${iconBg};display:flex;align-items:center;justify-content:center;flex-shrink:0;">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="${iconStroke}" stroke-width="2" stroke-linecap="round"><path d="M6.5 6.5h11"/><path d="M6.5 17.5h11"/><path d="M3 9.5h2v5H3z"/><path d="M19 9.5h2v5h-2z"/><path d="M5 12h14"/></svg>
        </div>
        <div>
          <p style="font-size:14px;font-weight:700;color:${nameColor};margin:0 0 2px;">${e.name}</p>
          <p style="font-size:12px;color:#9ca3af;margin:0;text-transform:capitalize;">${e.muscle} &middot; ${e.equipment}</p>
        </div>
      </div>
      <span style="font-size:11px;font-weight:600;color:${badgeColor};background:${badgeBg};padding:4px 10px;border-radius:20px;">${e.type}</span>
    </div>
  `).join('');
}

function filterExerciseLib(filter, btn) {
  currentExerciseFilter = filter;
  const isDark = document.body.classList.contains('dark');
  document.querySelectorAll('#tab-exercises button[onclick^="filterExerciseLib"]').forEach(b => {
    b.style.background = isDark ? '#252836' : 'white';
    b.style.color = '#6b7280';
    b.style.border = isDark ? '1.5px solid #3b4a63' : '1.5px solid #e2e4e7';
  });
  btn.style.background = isDark ? '#f0f1f3' : '#1a2332';
  btn.style.color = isDark ? '#1a2332' : 'white';
  btn.style.border = 'none';
  renderExerciseLib(filter);
}

function renderTrendsPage() {
  const log = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');

  // ── 1. Lifetime stats ──
  let totalSets = 0, totalReps = 0, totalVolume = 0;
  // Count unique workout sessions by date+name combo → unique workout days
  const workoutDays = new Set();
  log.forEach(e => {
    if (!e.isCardio) {
      totalSets   += Number(e.sets)  || 0;
      totalReps   += (Number(e.sets) || 0) * (Number(e.reps) || 0);
      totalVolume += (Number(e.sets) || 0) * (Number(e.reps) || 0) * (Number(e.weight) || 0);
    }
    workoutDays.add(e.date);
  });
  const fmtVol = totalVolume >= 1000
    ? (totalVolume / 1000).toFixed(1) + 'k'
    : totalVolume.toString();
  const wEl = document.getElementById('stat-workouts');
  const vEl = document.getElementById('stat-volume');
  const sEl = document.getElementById('stat-sets');
  const rEl = document.getElementById('stat-reps');
  if (wEl) wEl.textContent = workoutDays.size;
  if (vEl) vEl.innerHTML = fmtVol + ' <span style="font-size:13px;font-weight:500;color:#9ca3af;">lbs</span>';
  if (sEl) sEl.textContent = totalSets;
  if (rEl) rEl.textContent = totalReps;

  // ── 2. Personal Records ──
  const prMap = {}; // name → {weight, reps, date}
  log.forEach(e => {
    if (e.isCardio) return;
    const w = Number(e.weight) || 0;
    const r = Number(e.reps)   || 0;
    if (!prMap[e.name] || w > prMap[e.name].weight || (w === prMap[e.name].weight && r > prMap[e.name].reps)) {
      prMap[e.name] = { weight: w, reps: r, date: e.date };
    }
  });
  const prList = document.getElementById('pr-list');
  if (prList) {
    const entries = Object.entries(prMap);
    if (entries.length === 0) {
      prList.innerHTML = '<p style="padding:16px 20px;font-size:13px;color:#9ca3af;margin:0;">Log some sets to see your personal records here.</p>';
    } else {
      prList.innerHTML = entries.map(([name, pr], i) => `
        <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 20px;${i < entries.length-1 ? `border-bottom:1px solid ${dc('#f5f6f8','#2e3347')};` : ''}">
          <div>
            <p style="font-size:14px;font-weight:700;color:${dc('#1a2332','#f0f1f3')};margin:0 0 2px;">${name}</p>
            <p style="font-size:11px;color:#9ca3af;margin:0;">${pr.date}</p>
          </div>
          <div style="text-align:right;">
            <p style="font-size:16px;font-weight:800;color:${dc('#1a2332','#f0f1f3')};margin:0;">${pr.weight} <span style="font-size:11px;font-weight:500;color:#9ca3af;">lbs</span></p>
            <p style="font-size:11px;color:#9ca3af;margin:0;">${pr.reps} reps</p>
          </div>
        </div>
      `).join('');
    }
  }

  // ── 3. Per-exercise progress (over-time bar chart) ──
  const exMap = {}; // name → [{date, volume}]
  log.forEach(e => {
    if (e.isCardio) return;
    if (!exMap[e.name]) exMap[e.name] = [];
    exMap[e.name].push({
      date: e.date,
      vol: (Number(e.sets)||0) * (Number(e.reps)||0) * (Number(e.weight)||0),
      weight: Number(e.weight)||0,
      reps: Number(e.reps)||0,
    });
  });
  const epList = document.getElementById('exercise-progress-list');
  if (epList) {
    const exNames = Object.keys(exMap);
    if (exNames.length === 0) {
      epList.innerHTML = '<p style="padding:12px 8px;font-size:13px;color:#9ca3af;margin:0;">Log exercises to see progress charts here.</p>';
    } else {
      epList.innerHTML = exNames.map(name => {
        const sessions = exMap[name];
        const maxVol = Math.max(...sessions.map(s => s.vol), 1);
        const last = sessions[sessions.length - 1];
        const first = sessions[0];
        const pct = first.vol > 0 ? (((last.vol - first.vol) / first.vol) * 100).toFixed(1) : null;
        const pctLabel = pct !== null
          ? `<span style="font-size:12px;font-weight:700;color:${parseFloat(pct)>=0?'#059669':'#ef4444'}">${parseFloat(pct)>=0?'+':''}${pct}%</span>`
          : '';
        const bars = sessions.slice(-10).map(s => {
          const h = Math.max(8, Math.round((s.vol / maxVol) * 48));
          const barColor = dc('#2563eb', '#4f8ef7');
          return `<div style="flex:1;background:${barColor};border-radius:3px 3px 0 0;height:${h}px;min-width:6px;opacity:.9;transition:height .3s;" title="${s.date}: ${s.vol.toLocaleString()} lbs"></div>`;
        }).join('');
        const totalVol = sessions.reduce((a,s)=>a+s.vol,0);
        return `
          <div style="background:${dc('#f5f6f8','#252836')};border-radius:14px;padding:14px 16px;margin-top:10px;">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
              <span style="font-size:14px;font-weight:700;color:${dc('#1a2332','#f0f1f3')};">${name}</span>
              ${pctLabel}
            </div>
            <div style="display:flex;align-items:flex-end;gap:3px;height:48px;margin-bottom:8px;">
              ${bars}
            </div>
            <div style="display:flex;justify-content:space-between;">
              <p style="font-size:11px;color:#9ca3af;margin:0;">Last: <strong style="color:${dc('#1a2332','#f0f1f3')};">${last.weight} × ${last.reps}</strong></p>
              <p style="font-size:11px;color:#9ca3af;margin:0;">Best: <strong style="color:${dc('#1a2332','#f0f1f3')}">${Math.max(...sessions.map(s=>s.weight))} lbs</strong></p>
              <p style="font-size:11px;color:#9ca3af;margin:0;">Vol: <strong style="color:${dc('#1a2332','#f0f1f3')};">${totalVol.toLocaleString()} lbs</strong></p>
            </div>
          </div>
        `;
      }).join('');
    }
  }
}
// ─── END TRENDS ───

// ─── PROFILE PAGE ────────────────────────────────────────────────────────────
function renderProfilePage() {
  const log = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');
  const days = new Set(log.map(e => e.date)).size;
  const totalSets = log.reduce((s, e) => s + (e.sets || 1), 0);
  const totalReps = log.reduce((s, e) => s + (e.sets || 1) * (e.reps || 0), 0);
  const totalVol  = log.reduce((s, e) => s + (e.sets || 1) * (e.reps || 0) * (e.weight || 0), 0);
  const fmt = v => v >= 1000 ? (v / 1000).toFixed(1) + 'k' : v;
  const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
  set('profile-stat-workouts', days || 0);
  set('profile-stat-volume',   fmt(totalVol) + ' lbs');
  set('profile-stat-sets',     totalSets || 0);
  set('profile-stat-reps',     totalReps || 0);

  // ── Lifter Level card ──────────────────────────────────────────────────
  const levels = [
    { name: 'Novice',       tier: 'I',   min: 0,   max: 15,  color: '#6b7280', bg: '#f3f4f6' },
    { name: 'Intermediate', tier: 'II',  min: 15,  max: 40,  color: '#3b82f6', bg: '#dbeafe' },
    { name: 'Advanced',     tier: 'III', min: 40,  max: 80,  color: '#10b981', bg: '#d1fae5' },
    { name: 'Elite',        tier: 'IV',  min: 80,  max: 150, color: '#f59e0b', bg: '#fef3c7' },
    { name: 'Master',       tier: 'V',   min: 150, max: Infinity, color: '#7c3aed', bg: '#ede9fe' }
  ];
  const lvlIdx = levels.findIndex(l => days >= l.min && days < l.max);
  const lvl = lvlIdx >= 0 ? levels[lvlIdx] : levels[levels.length - 1];
  const nextLvl = levels[lvlIdx + 1] || null;
  const progress = nextLvl ? Math.min(100, Math.round(((days - lvl.min) / (lvl.max - lvl.min)) * 100)) : 100;
  // Update inline header level badge
  const badgeText = document.getElementById('profile-level-text');
  if (badgeText) { badgeText.textContent = 'Tier ' + lvl.tier + ' — ' + lvl.name; badgeText.style.color = lvl.color; }

  const levelEl = document.getElementById('lifter-level-card');
  if (levelEl) {
    const tierBar = levels.map((l, i) => {
      const active = i === (lvlIdx >= 0 ? lvlIdx : levels.length - 1);
      const passed = i < (lvlIdx >= 0 ? lvlIdx : levels.length - 1);
      return `<div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;">
        <div style="width:100%;height:28px;border-radius:4px;background:${active ? lvl.color : passed ? '#d1d5db' : '#f0f1f3'};border:${active ? '2px solid ' + lvl.color : '1.5px solid #e2e4e7'};transition:background .3s;"></div>
        <span style="font-size:9px;font-weight:${active ? '700' : '500'};color:${active ? lvl.color : '#9ca3af'};text-transform:uppercase;letter-spacing:.04em;">${l.tier}</span>
      </div>`;
    }).join('');
    levelEl.innerHTML = `
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <h3 style="font-size:14px;font-weight:700;color:#1a2332;margin:0;">Training Tier</h3>
        <span style="font-size:11px;font-weight:600;color:${lvl.color};background:${lvl.bg};padding:3px 10px;border-radius:20px;">Tier ${lvl.tier}</span>
      </div>
      <div style="display:flex;align-items:flex-start;gap:16px;margin-bottom:16px;">
        <div style="display:flex;gap:5px;flex:1;">${tierBar}</div>
        <div style="flex-shrink:0;min-width:0;">
          <p style="font-size:13px;font-weight:700;color:#1a2332;margin:0 0 3px;">Tier ${lvl.tier} — ${lvl.name}</p>
          <p style="font-size:11px;color:#9ca3af;margin:0 0 2px;">${days} session${days !== 1 ? 's' : ''} logged</p>
          <p style="font-size:11px;color:#9ca3af;margin:0;">${nextLvl ? (lvl.max - days) + ' sessions to ' + nextLvl.name : 'Max tier reached'}</p>
        </div>
      </div>
      <div style="height:5px;background:#f0f1f3;border-radius:99px;overflow:hidden;">
        <div style="height:100%;width:${progress}%;background:${lvl.color};border-radius:99px;transition:width .6s ease;"></div>
      </div>
    `;
  }

  // Recent Activity — group by date, show last 3 workout days
  const byDate = {};
  log.forEach(e => {
    if (!byDate[e.date]) byDate[e.date] = { exercises: new Set(), sets: 0, vol: 0 };
    byDate[e.date].exercises.add(e.exercise);
    byDate[e.date].sets += (e.sets || 1);
    byDate[e.date].vol  += (e.sets || 1) * (e.reps || 0) * (e.weight || 0);
  });
  const dates = Object.keys(byDate).sort((a, b) => new Date(b) - new Date(a)).slice(0, 3);
  const actEl = document.getElementById('profile-recent-activity');
  if (actEl) {
    if (dates.length === 0) {
      actEl.innerHTML = '<p style="font-size:13px;color:#9ca3af;text-align:center;padding:12px 0;">No recent workouts</p>';
    } else {
      actEl.innerHTML = dates.map(d => {
        const w = byDate[d];
        const exList = [...w.exercises].slice(0, 3).join(', ') + (w.exercises.size > 3 ? ' +' + (w.exercises.size - 3) + ' more' : '');
        return `<div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid ${dc('#f0f1f3','#2e3347')};">
          <div class="workout-icon-wrap" style="width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round"><path d="M6.5 6.5h11"/><path d="M6.5 17.5h11"/><path d="M3 9.5h2v5H3z"/><path d="M19 9.5h2v5h-2z"/><path d="M5 12h14"/></svg>
          </div>
          <div style="flex:1;min-width:0;">
            <p style="font-size:13px;font-weight:700;color:${dc('#1a2332','#f0f1f3')};margin:0 0 2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${exList}</p>
            <p style="font-size:11px;color:#9ca3af;margin:0;">${d} &middot; ${w.sets} sets &middot; ${fmt(w.vol)} lbs</p>
          </div>
        </div>`;
      }).join('');
    }
  }
}

// ─── COMMUNITY FEED ──────────────────────────────────────────────────────────

// Demo community posts (seed data)
const DEMO_POSTS = [
  {
    id: 'p1', type: 'log',
    user: { initials: 'MR', name: 'Marcus Reid', handle: '@marcusreid', location: 'Chicago, IL' },
    caption: 'Hit a new deadlift PR today. Consistency is everything.',
    log: { exercises: ['Deadlift', 'Romanian Deadlift', 'Leg Press'], sets: 12, reps: 52, volume: '14.2k lbs' },
    time: '2h ago', likes: 47, comments: [
      { user: 'Sarah K.', text: 'Absolute beast mode!' },
      { user: 'JD', text: 'Congrats on the PR!' }
    ]
  },
  {
    id: 'p2', type: 'media',
    user: { initials: 'SL', name: 'Sofia Lim', handle: '@sofialim', location: 'Los Angeles, CA' },
    caption: '225 lbs bench press — finally hit it after 3 months of grinding.',
    mediaColor: '#1a2332',
    mediaLabel: 'Bench Press 225 lbs',
    time: '4h ago', likes: 83, comments: [
      { user: 'Marcus R.', text: 'Let\'s go Sofia!' }
    ]
  },
  {
    id: 'p3', type: 'log',
    user: { initials: 'TW', name: 'Tyler Webb', handle: '@tylerwebb', location: 'Austin, TX' },
    caption: 'Push day done. Shoulders are cooked.',
    log: { exercises: ['Overhead Press', 'Lateral Raise', 'Tricep Pushdown', 'Chest Fly'], sets: 16, reps: 128, volume: '8.7k lbs' },
    time: '6h ago', likes: 31, comments: []
  },
  {
    id: 'p4', type: 'media',
    user: { initials: 'AJ', name: 'Aisha Johnson', handle: '@aishaj', location: 'New York, NY' },
    caption: 'Morning run + leg day. No days off.',
    mediaColor: '#374151',
    mediaLabel: 'Morning Cardio + Squats',
    time: '8h ago', likes: 62, comments: [
      { user: 'Tyler W.', text: 'That dedication is unreal.' },
      { user: 'Sofia L.', text: 'Goals!' }
    ]
  },
  {
    id: 'p5', type: 'log',
    user: { initials: 'RK', name: 'Ryan Kim', handle: '@ryankim', location: 'Seattle, WA' },
    caption: 'Back and biceps. Volume was up this week.',
    log: { exercises: ['Pull-Up', 'Cable Row', 'Barbell Curl', 'Face Pull'], sets: 14, reps: 112, volume: '9.1k lbs' },
    time: '1d ago', likes: 28, comments: []
  }
];

// Track liked posts and user posts
let communityLiked = {};
let userPosts = [];
let composerType = 'log';
let composerMediaFile = null;

const STORY_USERS = [
  { initials: 'MR', name: 'Marcus', color: '#374151' },
  { initials: 'SL', name: 'Sofia',  color: '#4b5563' },
  { initials: 'TW', name: 'Tyler',  color: '#1f2937' },
  { initials: 'AJ', name: 'Aisha',  color: '#111827' },
  { initials: 'RK', name: 'Ryan',   color: '#374151' },
];

function renderCommunityFeed() {

  // Update composer log preview
  const logPreview = document.getElementById('composer-log-preview');
  if (logPreview) {
    const log = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');
    const today = new Date().toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });
    const todayEntries = log.filter(e => e.date && e.date.replace(/\s+/g,' ').trim() === today.replace(/\s+/g,' ').trim());
    if (todayEntries.length > 0) {
      const exNames = [...new Set(todayEntries.map(e => e.name))].slice(0,3).join(', ');
      logPreview.textContent = exNames + (todayEntries.length > 3 ? ' +more' : '');
    } else {
      const recent = log.slice(-3);
      if (recent.length > 0) {
        const exNames = [...new Set(recent.map(e => e.name))].slice(0,3).join(', ');
        logPreview.textContent = 'Recent: ' + exNames;
      } else {
        logPreview.textContent = 'No workouts logged yet';
      }
    }
  }

  // Build feed: user posts first, then demo posts
  const allPosts = [...userPosts, ...DEMO_POSTS];
  const feedEl = document.getElementById('community-feed');
  if (!feedEl) return;
  feedEl.innerHTML = allPosts.map(post => buildPostCard(post)).join('');
}

function buildPostCard(post) {
  const liked = !!communityLiked[post.id];
  const likeCount = post.likes + (liked ? 1 : 0);

  // Header
  const header = `
    <div style="display:flex;align-items:center;gap:10px;padding:14px 16px 10px;">
      <div style="width:40px;height:40px;border-radius:50%;background:${post.user.color || '#1a2332'};display:flex;align-items:center;justify-content:center;flex-shrink:0;">
        <span style="font-size:14px;font-weight:800;color:white;">${post.user.initials}</span>
      </div>
      <div style="flex:1;min-width:0;">
        <p style="font-size:14px;font-weight:700;color:#1a2332;margin:0 0 1px;">${post.user.name}</p>
        <p style="font-size:11px;color:#9ca3af;margin:0;">${post.user.handle} &middot; ${post.time}</p>
      </div>
      <button style="background:none;border:none;cursor:pointer;padding:4px;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg>
      </button>
    </div>`;

  // Caption
  const caption = post.caption ? `<p style="font-size:14px;color:#374151;margin:0;padding:0 16px 12px;line-height:1.5;">${post.caption}</p>` : '';

  // Body: workout log card or media
  let body = '';
  if (post.type === 'log' && post.log) {
    const exList = post.log.exercises.slice(0,4).join(' &middot; ') + (post.log.exercises.length > 4 ? ' +more' : '');
    body = `
      <div style="margin:0 16px 12px;background:#f5f6f8;border-radius:14px;padding:14px;">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px;">
          <div style="width:28px;height:28px;border-radius:8px;background:#1a2332;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><path d="M6.5 6.5h11"/><path d="M6.5 17.5h11"/><path d="M3 9.5h2v5H3z"/><path d="M19 9.5h2v5h-2z"/><path d="M5 12h14"/></svg>
          </div>
          <span style="font-size:12px;font-weight:700;color:#1a2332;">Workout Log</span>
        </div>
        <p style="font-size:12px;color:#6b7280;margin:0 0 10px;line-height:1.5;">${exList}</p>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;">
          <div style="background:white;border-radius:10px;padding:8px 10px;text-align:center;">
            <p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">${post.log.sets}</p>
            <p style="font-size:10px;color:#9ca3af;margin:0;font-weight:500;">Sets</p>
          </div>
          <div style="background:white;border-radius:10px;padding:8px 10px;text-align:center;">
            <p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">${post.log.reps}</p>
            <p style="font-size:10px;color:#9ca3af;margin:0;font-weight:500;">Reps</p>
          </div>
          <div style="background:white;border-radius:10px;padding:8px 10px;text-align:center;">
            <p style="font-size:14px;font-weight:800;color:#1a2332;margin:0;">${post.log.volume}</p>
            <p style="font-size:10px;color:#9ca3af;margin:0;font-weight:500;">Volume</p>
          </div>
        </div>
      </div>`;
  } else if (post.type === 'media') {
    if (post.mediaUrl) {
      // Real uploaded media
      if (post.isVideo) {
        body = `<div style="position:relative;margin-bottom:12px;">
          <video src="${post.mediaUrl}" class="feed-card-media" muted playsinline controls style="aspect-ratio:1;object-fit:cover;width:100%;"></video>
        </div>`;
      } else {
        body = `<img src="${post.mediaUrl}" class="feed-card-media" style="margin-bottom:12px;" alt="post media">`;
      }
    } else {
      // Placeholder for demo posts
      body = `
        <div class="post-img-placeholder" style="margin:0 16px 12px;border-radius:14px;overflow:hidden;aspect-ratio:1;display:flex;align-items:center;justify-content:center;">
          <div style="text-align:center;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round" style="margin-bottom:8px;"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
            <p style="font-size:12px;font-weight:600;color:#9ca3af;margin:0;">${post.mediaLabel || 'Media'}</p>
          </div>
        </div>`;
    }
  }

  // Comments preview (up to 2)
  let commentsHtml = '';
  if (post.comments && post.comments.length > 0) {
    const shown = post.comments.slice(0, 2);
    commentsHtml = `<div style="padding:0 16px 8px;">${shown.map(c =>
      `<p style="font-size:13px;color:#374151;margin:0 0 4px;"><span style="font-weight:700;">${c.user}</span> ${c.text}</p>`
    ).join('')}${post.comments.length > 2 ? `<p style="font-size:12px;color:#9ca3af;margin:0;">View all ${post.comments.length} comments</p>` : ''}</div>`;
  }

  // Actions bar
  const actions = `
    <div style="display:flex;align-items:center;gap:8px;padding:10px 16px;border-top:1px solid #f0f1f3;">
      <button class="like-btn ${liked ? 'liked' : ''}" onclick="toggleLike('${post.id}', this)">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="${liked ? '#ef4444' : 'none'}" stroke="${liked ? '#ef4444' : 'currentColor'}" stroke-width="2" stroke-linecap="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        ${likeCount}
      </button>
      <button class="like-btn" onclick="focusComment('${post.id}')">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        ${(post.comments || []).length}
      </button>
      <button class="like-btn" style="margin-left:auto;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
        Share
      </button>
    </div>
    <div class="comment-input-row" id="comment-row-${post.id}">
      <div style="width:28px;height:28px;border-radius:50%;background:#1a2332;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
        <span style="font-size:10px;font-weight:800;color:white;">JD</span>
      </div>
      <input class="comment-input" id="comment-input-${post.id}" placeholder="Add a comment..." onkeydown="submitComment(event, '${post.id}')">
    </div>`;

  return `<div class="feed-card" id="post-${post.id}">${header}${caption}${body}${commentsHtml}${actions}</div>`;
}

function toggleLike(postId, btn) {
  communityLiked[postId] = !communityLiked[postId];
  const liked = communityLiked[postId];
  // Find the post
  const allPosts = [...userPosts, ...DEMO_POSTS];
  const post = allPosts.find(p => p.id === postId);
  if (!post) return;
  const count = post.likes + (liked ? 1 : 0);
  btn.className = 'like-btn' + (liked ? ' liked' : '');
  btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="${liked ? '#ef4444' : 'none'}" stroke="${liked ? '#ef4444' : 'currentColor'}" stroke-width="2" stroke-linecap="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>${count}`;
}

function focusComment(postId) {
  const input = document.getElementById('comment-input-' + postId);
  if (input) input.focus();
}

function submitComment(event, postId) {
  if (event.key !== 'Enter') return;
  const input = document.getElementById('comment-input-' + postId);
  const text = input.value.trim();
  if (!text) return;
  input.value = '';
  // Add comment to the post
  const allPosts = [...userPosts, ...DEMO_POSTS];
  const post = allPosts.find(p => p.id === postId);
  if (post) {
    post.comments = post.comments || [];
    post.comments.push({ user: 'JD', text });
  }
  // Re-render just the comments section of this card
  renderCommunityFeed();
}

function openPostComposer() {
  const composer = document.getElementById('post-composer');
  if (!composer) return;
  composer.style.display = 'block';
  composer.scrollIntoView({ behavior: 'smooth', block: 'start' });
  renderCommunityFeed(); // refresh log preview
}

function closePostComposer() {
  const composer = document.getElementById('post-composer');
  if (composer) composer.style.display = 'none';
  composerMediaFile = null;
  const preview = document.getElementById('composer-media-preview');
  if (preview) { preview.style.display = 'none'; preview.innerHTML = ''; }
  const cap1 = document.getElementById('composer-caption');
  const cap2 = document.getElementById('composer-media-caption');
  if (cap1) cap1.value = '';
  if (cap2) cap2.value = '';
}

function setComposerType(type) {
  composerType = type;
  document.getElementById('ctype-log').classList.toggle('active', type === 'log');
  document.getElementById('ctype-media').classList.toggle('active', type === 'media');
  document.getElementById('composer-log-section').style.display = type === 'log' ? 'block' : 'none';
  document.getElementById('composer-media-section').style.display = type === 'media' ? 'block' : 'none';
}

function previewComposerMedia(event) {
  const file = event.target.files[0];
  if (!file) return;
  composerMediaFile = file;
  const url = URL.createObjectURL(file);
  const preview = document.getElementById('composer-media-preview');
  preview.style.display = 'block';
  if (file.type.startsWith('video/')) {
    preview.innerHTML = `<video src="${url}" style="width:100%;height:100%;object-fit:cover;" muted playsinline controls></video>`;
  } else {
    preview.innerHTML = `<img src="${url}" style="width:100%;height:100%;object-fit:cover;" alt="preview">`;
  }
}

function submitPost() {
  const isLog = composerType === 'log';
  const caption = isLog
    ? (document.getElementById('composer-caption').value.trim())
    : (document.getElementById('composer-media-caption').value.trim());
  const includeLog = isLog && document.getElementById('composer-include-log').checked;

  let logData = null;
  if (includeLog) {
    const log = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');
    const exercises = [...new Set(log.slice(-10).map(e => e.name))];
    const totalSets = log.slice(-10).reduce((s, e) => s + (e.sets || 1), 0);
    const totalReps = log.slice(-10).reduce((s, e) => s + (e.sets || 1) * (e.reps || 0), 0);
    const totalVol  = log.slice(-10).reduce((s, e) => s + (e.sets || 1) * (e.reps || 0) * (e.weight || 0), 0);
    const fmtV = v => v >= 1000 ? (v/1000).toFixed(1)+'k lbs' : v+' lbs';
    logData = { exercises, sets: totalSets, reps: totalReps, volume: fmtV(totalVol) };
  }

  const newPost = {
    id: 'u' + Date.now(),
    type: isLog ? 'log' : 'media',
    user: { initials: 'JD', name: 'John Doe', handle: '@johndoe', location: 'New York, United States', color: '#1a2332' },
    caption,
    log: logData,
    time: 'Just now',
    likes: 0,
    comments: []
  };

  if (!isLog && composerMediaFile) {
    newPost.mediaUrl = URL.createObjectURL(composerMediaFile);
    newPost.isVideo = composerMediaFile.type.startsWith('video/');
  } else if (!isLog) {
    newPost.mediaColor = '#1a2332';
    newPost.mediaLabel = caption || 'My Workout';
  }

  userPosts.unshift(newPost);
  closePostComposer();
  renderCommunityFeed();
}
// ─── END COMMUNITY FEED ───

function openProfileComposer() {
  // Trigger the media upload input on the profile page
  const input = document.getElementById('media-upload-input');
  if (input) input.click();
}

function handleMediaUpload(event) {
  const files = Array.from(event.target.files);
  if (!files.length) return;
  const grid = document.getElementById('media-grid');
  if (!grid) return;
  // Hide empty state if showing
  const emptyState = document.getElementById('media-empty-state');
  if (emptyState) emptyState.style.display = 'none';
  // Keep the upload tile at the start, append new media tiles
  files.forEach(file => {
    const url = URL.createObjectURL(file);
    const isVideo = file.type.startsWith('video/');
    const item = document.createElement('div');
    item.style.cssText = 'position:relative;overflow:hidden;aspect-ratio:1;background:#f0f1f3;';
    if (isVideo) {
      item.innerHTML = `<video src="${url}" style="width:100%;height:100%;object-fit:cover;" muted playsinline></video><div style="position:absolute;top:6px;right:6px;"><div style="width:24px;height:24px;border-radius:50%;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;"><svg width="10" height="10" viewBox="0 0 24 24" fill="white"><polygon points="5 3 19 12 5 21 5 3"/></svg></div></div>`;
    } else {
      item.innerHTML = `<img src="${url}" style="width:100%;height:100%;object-fit:cover;" alt="media">`;
    }
    grid.appendChild(item);
  });
}

function switchProfileTab(tab) {
  // Update tab underline indicators
  const tabs = { posts: 'ptab-posts', logs: 'ptab-logs', prs: 'ptab-prs' };
  const panels = { posts: 'profile-panel-posts', logs: 'profile-panel-logs', prs: 'profile-panel-prs' };
  const isDark = document.body.classList.contains('dark');
  const activeStroke = isDark ? '#f0f1f3' : '#1a2332';
  const activeBorder = isDark ? '#f0f1f3' : '#1a2332';
  Object.keys(tabs).forEach(t => {
    const btn = document.getElementById(tabs[t]);
    const panel = document.getElementById(panels[t]);
    const isActive = t === tab;
    if (btn) {
      btn.style.borderBottom = isActive ? `2px solid ${activeBorder}` : '2px solid transparent';
      btn.querySelectorAll('svg').forEach(svg => svg.setAttribute('stroke', isActive ? activeStroke : '#9ca3af'));
    }
    if (panel) panel.style.display = isActive ? 'block' : 'none';
  });
}

function openSettingsPanel() {
  // Hide all tabs
  ['tab-log','tab-measurements','tab-history','tab-trends','tab-routines','tab-exercises','tab-community','tab-profile','tab-settings'].forEach(id => {
    const t = document.getElementById(id); if (t) t.style.display = 'none';
  });
  // Deactivate footer nav items
  ['log','community','profile'].forEach(n => {
    const el = document.getElementById('nav-' + n);
    if (!el) return;
    el.classList.remove('active');
    el.querySelector('svg').setAttribute('stroke','#9ca3af');
    el.querySelector('span').style.color = '#9ca3af';
    el.querySelector('span').style.fontWeight = '500';
  });
  // Show settings tab
  const settingsTab = document.getElementById('tab-settings');
  if (settingsTab) settingsTab.style.display = 'block';
  // Show standard header with Settings title
  const logHeader = document.getElementById('header-log');
  const headerAddBtn = document.getElementById('header-add-btn');
  const dateHeader = document.getElementById('dateHeader');
  const settingsHeader = document.getElementById('settingsHeader');
  const calendarBtn = document.getElementById('calendar-btn');
  const pageTitle = document.getElementById('pageTitle');
  if (logHeader) logHeader.style.display = 'flex';
  if (headerAddBtn) headerAddBtn.style.display = 'none';
  if (dateHeader) dateHeader.style.display = 'none';
  if (pageTitle) pageTitle.style.display = 'none';
  if (settingsHeader) settingsHeader.style.display = 'block';
  if (calendarBtn) calendarBtn.style.display = 'none';
  // Close sidebar
  toggleSidebar();
}

function setUnit(unit) {
  const lbsBtn = document.getElementById('unit-lbs');
  const kgBtn  = document.getElementById('unit-kg');
  if (unit === 'lbs') {
    lbsBtn.style.background = '#1a2332'; lbsBtn.style.color = 'white'; lbsBtn.style.borderColor = '#1a2332';
    kgBtn.style.background  = 'white';   kgBtn.style.color  = '#9ca3af'; kgBtn.style.borderColor = '#e2e4e7';
  } else {
    kgBtn.style.background  = '#1a2332'; kgBtn.style.color  = 'white'; kgBtn.style.borderColor = '#1a2332';
    lbsBtn.style.background = 'white';   lbsBtn.style.color = '#9ca3af'; lbsBtn.style.borderColor = '#e2e4e7';
  }
  localStorage.setItem('flextab-unit', unit);
  // Also sync the settings page unit buttons
  const sLbs = document.getElementById('settings-unit-lbs');
  const sKg  = document.getElementById('settings-unit-kg');
  if (sLbs && sKg) {
    if (unit === 'lbs') {
      sLbs.style.background = '#1a2332'; sLbs.style.color = 'white'; sLbs.style.borderColor = '#1a2332';
      sKg.style.background  = 'white';   sKg.style.color  = '#9ca3af'; sKg.style.borderColor = '#e2e4e7';
    } else {
      sKg.style.background  = '#1a2332'; sKg.style.color  = 'white'; sKg.style.borderColor = '#1a2332';
      sLbs.style.background = 'white';   sLbs.style.color = '#9ca3af'; sLbs.style.borderColor = '#e2e4e7';
    }
  }
}

// ─── DARK MODE HELPER ───────────────────────────────────────────────────────
function isDark() { return document.body.classList.contains('dark'); }
function dc(light, dark) { return isDark() ? dark : light; }

// ─── APPEARANCE / DARK MODE ──────────────────────────────────────────────────
// Light-to-dark colour map for inline style replacement
const DARK_COLOR_MAP = [
  // backgrounds
  { find: /background:\s*white/g,    replace: 'background:#1e2130' },
  { find: /background:\s*#f0f1f3/g,  replace: 'background:#252836' },
  { find: /background:\s*#f5f6f8/g,  replace: 'background:#252836' },
  { find: /background:\s*#f9fafb/g,  replace: 'background:#252836' },
  { find: /background:\s*#f3f4f6/g,  replace: 'background:#252836' },
  { find: /background:\s*#e2e4e7/g,  replace: 'background:#2e3347' },
  { find: /background:\s*#e8e9eb/g,  replace: 'background:#2e3347' },
  // text colours
  { find: /color:\s*#1a2332/g,       replace: 'color:#f0f1f3' },
  { find: /color:\s*#374151/g,       replace: 'color:#d1d5db' },
  { find: /color:\s*#4b5563/g,       replace: 'color:#9ca3af' },
  { find: /color:\s*#555/g,          replace: 'color:#9ca3af' },
  // borders
  { find: /border-bottom:\s*1px solid #f0f1f3/g, replace: 'border-bottom:1px solid #2e3347' },
  { find: /border-bottom:\s*1px solid #e2e4e7/g, replace: 'border-bottom:1px solid #2e3347' },
  { find: /border-bottom:\s*1px solid #f5f6f8/g, replace: 'border-bottom:1px solid #2e3347' },
  { find: /border-top:\s*1px solid #f0f1f3/g,    replace: 'border-top:1px solid #2e3347' },
  { find: /border-top:\s*1px solid #e8e9eb/g,    replace: 'border-top:1px solid #2e3347' },
  { find: /border:\s*1px solid #f0f1f3/g,        replace: 'border:1px solid #2e3347' },
  { find: /border:\s*1\.5px solid #e2e4e7/g,     replace: 'border:1.5px solid #2e3347' },
  { find: /border:\s*1\.5px solid #d1d5db/g,     replace: 'border:1.5px solid #2e3347' },
  { find: /border-color:\s*#e2e4e7/g,            replace: 'border-color:#2e3347' },
  { find: /border-right:\s*1px solid #f0f1f3/g,   replace: 'border-right:1px solid #2e3347' },
  { find: /border-right:\s*1px solid #e2e4e7/g,   replace: 'border-right:1px solid #2e3347' },
  { find: /border-left:\s*1px solid #f0f1f3/g,    replace: 'border-left:1px solid #2e3347' },
  { find: /border-left:\s*1px solid #e2e4e7/g,    replace: 'border-left:1px solid #2e3347' },
  // SVG strokes
  { find: /stroke:\s*#1a2332/g,      replace: 'stroke:#f0f1f3' },
];

const LIGHT_COLOR_MAP = [
  { find: /background:\s*#1e2130/g,  replace: 'background:white' },
  { find: /background:\s*#252836/g,  replace: 'background:#f5f6f8' },
  { find: /background:\s*#2e3347/g,  replace: 'background:#e2e4e7' },
  { find: /color:\s*#f0f1f3/g,       replace: 'color:#1a2332' },
  { find: /color:\s*#d1d5db/g,       replace: 'color:#374151' },
  { find: /border-bottom:\s*1px solid #2e3347/g, replace: 'border-bottom:1px solid #f0f1f3' },
  { find: /border-top:\s*1px solid #2e3347/g,    replace: 'border-top:1px solid #e8e9eb' },
  { find: /border:\s*1px solid #2e3347/g,        replace: 'border:1px solid #f0f1f3' },
  { find: /border:\s*1\.5px solid #2e3347/g,     replace: 'border:1.5px solid #e2e4e7' },
  { find: /border-color:\s*#2e3347/g,            replace: 'border-color:#e2e4e7' },
  { find: /border-right:\s*1px solid #2e3347/g,   replace: 'border-right:1px solid #f0f1f3' },
  { find: /border-left:\s*1px solid #2e3347/g,    replace: 'border-left:1px solid #f0f1f3' },
  { find: /stroke:\s*#f0f1f3/g,      replace: 'stroke:#1a2332' },
];

// Snapshot original inline styles before first dark mode application
let _lightStylesSnapshot = null;
function snapshotLightStyles() {
  _lightStylesSnapshot = new Map();
  document.querySelectorAll('[style]').forEach(el => {
    _lightStylesSnapshot.set(el, el.getAttribute('style'));
  });
}
function applyColorMapToDOM(map) {
  // Walk every element with an inline style attribute
  document.querySelectorAll('[style]').forEach(el => {
    let s = el.getAttribute('style');
    let changed = false;
    map.forEach(({ find, replace }) => {
      const next = s.replace(find, replace);
      if (next !== s) { s = next; changed = true; }
    });
    if (changed) el.setAttribute('style', s);
  });
}
function restoreLightStyles() {
  if (!_lightStylesSnapshot) return;
  // Restore all snapshotted elements
  _lightStylesSnapshot.forEach((style, el) => {
    if (document.contains(el)) el.setAttribute('style', style);
  });
  // Also reset any elements that gained inline styles after snapshot (dynamic content)
  // by re-running the light color map on remaining elements
  applyColorMapToDOM(LIGHT_COLOR_MAP);
}

function setAppearance(mode) {
  localStorage.setItem('flextab-appearance', mode);
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const isDark = mode === 'dark' || (mode === 'system' && prefersDark);

  if (isDark) {
    if (!_lightStylesSnapshot) snapshotLightStyles();
    document.body.classList.add('dark');
    applyColorMapToDOM(DARK_COLOR_MAP);
  } else {
    document.body.classList.remove('dark');
    restoreLightStyles();
  }
  // Style all btn-primary-solid buttons (inline styles override CSS class rules)
  document.querySelectorAll('.btn-primary-solid').forEach(btn => {
    if (isDark) {
      btn.style.background = '#f0f1f3';
      btn.style.borderColor = '#f0f1f3';
      btn.style.color = '#1a2332';
      const icon = btn.querySelector('.btn-primary-solid-icon, svg');
      if (icon) icon.setAttribute('stroke', '#1a2332');
    } else {
      btn.style.background = '#1a2332';
      btn.style.borderColor = '#1a2332';
      btn.style.color = 'white';
      const icon = btn.querySelector('.btn-primary-solid-icon, svg');
      if (icon) icon.setAttribute('stroke', 'white');
    }
  });
  // Save Measurements button — same treatment as New Routine
  document.querySelectorAll('.btn-primary').forEach(btn => {
    if (isDark) {
      btn.style.background = '#f0f1f3';
      btn.style.color = '#1a2332';
    } else {
      btn.style.background = '#1a2332';
      btn.style.color = 'white';
    }
  });

  // Re-render dynamic pages so dc() colours update
  const activeSidebar = document.querySelector('.sidebar-nav-item.active');
  const activeNav = document.querySelector('.nav-item.active');
  if (activeSidebar) {
    const name = activeSidebar.id.replace('snav-','');
    if (name === 'trends') renderTrendsPage();
    if (name === 'history') renderHistoryPage();
    if (name === 'exercises') {
      // Re-apply pill styles for the exercise lib filter buttons
      const isDarkNow = document.body.classList.contains('dark');
      document.querySelectorAll('#tab-exercises button[onclick^="filterExerciseLib"]').forEach(b => {
        const isActive = b.style.background === 'rgb(26, 35, 50)' || b.style.background === 'rgb(240, 241, 243)';
        if (isActive) {
          b.style.background = isDarkNow ? '#f0f1f3' : '#1a2332';
          b.style.color = isDarkNow ? '#1a2332' : 'white';
          b.style.border = 'none';
        } else {
          b.style.background = isDarkNow ? '#252836' : 'white';
          b.style.color = '#6b7280';
          b.style.border = isDarkNow ? '1.5px solid #3b4a63' : '1.5px solid #e2e4e7';
        }
      });
      renderExerciseLib();
    }
  }
  if (activeNav) {
    const name = activeNav.id.replace('nav-','');
    if (name === 'profile') { renderProfilePage(); switchProfileTab('posts'); }
  }

  // Update the 3-way button states
  ['light','system','dark'].forEach(m => {
    const btn = document.getElementById('appear-' + m);
    if (!btn) return;
    const isActive = m === mode;
    btn.style.background = isActive ? (isDark ? '#3b4a63' : '#1a2332') : 'transparent';
    btn.style.color = isActive ? 'white' : '#6b7280';
  });
}

// ─── SETTINGS EDIT SHEET ──────────────────────────────────────────────────────
let _settingsEditField = null;

function openSettingsEdit(field, title, type, currentVal) {
  _settingsEditField = field;
  const overlay = document.getElementById('settings-sheet-overlay');
  const sheet   = document.getElementById('settings-sheet');
  const titleEl = document.getElementById('settings-sheet-title');
  const inputWrap = document.getElementById('settings-sheet-input-wrap');
  const input   = document.getElementById('settings-sheet-input');
  const optionsWrap = document.getElementById('settings-sheet-options');

  titleEl.textContent = 'Edit ' + title;

  if (field === 'visibility') {
    // Show radio options instead of text input
    inputWrap.style.display = 'none';
    optionsWrap.style.display = 'block';
    const opts = ['Public', 'Friends Only', 'Private'];
    optionsWrap.innerHTML = opts.map(o => `
      <div onclick="selectSheetOption(this, '${o}')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-radius:14px;border:1.5px solid ${o===currentVal?'#1a2332':'#e2e4e7'};background:${o===currentVal?'#f5f6f8':'white'};cursor:pointer;margin-bottom:8px;" data-val="${o}">
        <span style="font-size:14px;font-weight:600;color:#1a2332;">${o}</span>
        ${o===currentVal ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>' : ''}
      </div>
    `).join('');
  } else {
    inputWrap.style.display = 'block';
    optionsWrap.style.display = 'none';
    input.type = type;
    input.value = type === 'password' ? '' : currentVal;
    input.placeholder = type === 'password' ? 'Enter new password' : 'Enter ' + title.toLowerCase();
  }

  overlay.style.display = 'block';
  requestAnimationFrame(() => { sheet.style.transform = 'translateY(0)'; });
  setTimeout(() => { if (type !== 'password') input.focus(); }, 350);
}

function selectSheetOption(el, val) {
  const wrap = document.getElementById('settings-sheet-options');
  wrap.querySelectorAll('[data-val]').forEach(item => {
    const isSelected = item.dataset.val === val;
    item.style.borderColor = isSelected ? '#1a2332' : '#e2e4e7';
    item.style.background  = isSelected ? '#f5f6f8' : 'white';
    item.innerHTML = `<span style="font-size:14px;font-weight:600;color:#1a2332;">${item.dataset.val}</span>${isSelected ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>' : ''}`;
  });
}

function saveSettingsSheet() {
  const field = _settingsEditField;
  const inputWrap = document.getElementById('settings-sheet-input-wrap');
  const input = document.getElementById('settings-sheet-input');
  const optionsWrap = document.getElementById('settings-sheet-options');

  let newVal = '';
  if (optionsWrap.style.display !== 'none') {
    const selected = optionsWrap.querySelector('[style*="#f5f6f8"]');
    newVal = selected ? selected.dataset.val : '';
  } else {
    newVal = input.value.trim();
  }

  if (!newVal) { input.style.borderColor = '#ef4444'; return; }

  const valEl = document.getElementById('settings-val-' + field);
  if (valEl) {
    if (field === 'password') {
      valEl.textContent = '\u2022'.repeat(8);
    } else {
      valEl.textContent = newVal;
    }
  }
  localStorage.setItem('flextab-setting-' + field, newVal);
  closeSettingsSheet();
}

function closeSettingsSheet() {
  const sheet = document.getElementById('settings-sheet');
  const overlay = document.getElementById('settings-sheet-overlay');
  sheet.style.transform = 'translateY(100%)';
  setTimeout(() => { overlay.style.display = 'none'; }, 300);
}

// ─── FITNESS GOAL SHEET ───────────────────────────────────────────────────────
const FITNESS_GOALS = ['Build Muscle', 'Lose Weight', 'Improve Endurance', 'Increase Strength', 'General Fitness', 'Athletic Performance'];

function openFitnessGoalSheet() {
  const overlay = document.getElementById('goal-sheet-overlay');
  const sheet   = document.getElementById('goal-sheet');
  const current = document.getElementById('settings-val-goal').textContent;
  const container = document.getElementById('goal-options');
  container.innerHTML = FITNESS_GOALS.map(g => `
    <div onclick="selectFitnessGoal('${g}')" style="display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-radius:14px;border:1.5px solid ${g===current?'#1a2332':'#e2e4e7'};background:${g===current?'#f5f6f8':'white'};cursor:pointer;" data-goal="${g}">
      <span style="font-size:14px;font-weight:600;color:#1a2332;">${g}</span>
      ${g===current ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>' : ''}
    </div>
  `).join('');
  overlay.style.display = 'block';
  requestAnimationFrame(() => { sheet.style.transform = 'translateY(0)'; });
}

function selectFitnessGoal(goal) {
  const container = document.getElementById('goal-options');
  container.querySelectorAll('[data-goal]').forEach(item => {
    const isSelected = item.dataset.goal === goal;
    item.style.borderColor = isSelected ? '#1a2332' : '#e2e4e7';
    item.style.background  = isSelected ? '#f5f6f8' : 'white';
    item.innerHTML = `<span style="font-size:14px;font-weight:600;color:#1a2332;">${item.dataset.goal}</span>${isSelected ? '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>' : ''}`;
  });
  document.getElementById('settings-val-goal').textContent = goal;
  localStorage.setItem('flextab-setting-goal', goal);
  setTimeout(() => closeFitnessGoalSheet(), 250);
}

function closeFitnessGoalSheet() {
  const sheet = document.getElementById('goal-sheet');
  const overlay = document.getElementById('goal-sheet-overlay');
  sheet.style.transform = 'translateY(100%)';
  setTimeout(() => { overlay.style.display = 'none'; }, 300);
}

// ─── CONFIRM DIALOGS ──────────────────────────────────────────────────────────
function confirmSignOut() {
  if (confirm('Sign out of FlexTab?')) {
    alert('Signed out. (In production this would redirect to the login screen.)');
  }
}

function confirmDeleteAccount() {
  if (confirm('Are you sure you want to permanently delete your account? This cannot be undone.')) {
    alert('Account deletion requested. (In production this would remove all data.)');
  }
}

// ─── INIT APPEARANCE ON LOAD ──────────────────────────────────────────────────
(function initAppearance() {
  const saved = localStorage.getItem('flextab-appearance') || 'light';
  // Apply immediately so there is no flash
  setAppearance(saved);
  // Also sync button states once DOM is fully ready
  if (document.readyState !== 'complete') {
    window.addEventListener('load', () => setAppearance(saved));
  }
})();

// ─── END PROFILE ───

// ─── HISTORY PAGE ─────────────────────────────────────────────────────────
function renderHistoryPage() {
  const log = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');
  const container = document.getElementById('history-list');
  if (!container) return;

  if (!log.length) {
    container.innerHTML = `<div style="background:white;border-radius:20px;border:1px solid #f0f1f3;padding:48px 24px;text-align:center;">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#d1d5db" stroke-width="1.5" stroke-linecap="round" style="margin-bottom:12px;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      <p style="font-size:15px;font-weight:700;color:#1a2332;margin:0 0 6px;">No workouts logged yet</p>
      <p style="font-size:13px;color:#9ca3af;margin:0;">Log a set to see your history here.</p>
    </div>`;
    return;
  }

  // Group entries by date
  const byDate = {};
  log.forEach(e => {
    const d = e.date || 'Unknown';
    if (!byDate[d]) byDate[d] = [];
    byDate[d].push(e);
  });

  // Sort dates newest first
  const dates = Object.keys(byDate).sort((a, b) => {
    return new Date(b) - new Date(a);
  });

  container.innerHTML = dates.map(date => {
    const entries = byDate[date];

    // Group entries by exercise name within this day
    const byExercise = {};
    entries.forEach(e => {
      if (!byExercise[e.name]) byExercise[e.name] = [];
      byExercise[e.name].push(e);
    });

    // Day-level totals
    const dayTotalSets = entries.reduce((s, e) => s + (e.sets || 1), 0);
    const dayTotalReps = entries.reduce((s, e) => s + (e.sets || 1) * (e.reps || 0), 0);
    const dayTotalVol  = entries.reduce((s, e) => s + (e.sets || 1) * (e.reps || 0) * (e.weight || 0), 0);
    const dayExCount   = Object.keys(byExercise).length;
    const fmtVol = v => v >= 1000 ? (v / 1000).toFixed(1) + 'k' : v;

    // Build exercise rows
    const exerciseRows = Object.entries(byExercise).map(([exName, sets]) => {
      // Check if all sets have identical weight AND reps
      const allSame = sets.every(s => s.weight === sets[0].weight && s.reps === sets[0].reps);
      const totalSetsForEx = sets.reduce((s, e) => s + (e.sets || 1), 0);

      // Build flat set list for mini bar chart
      const flatSets = [];
      sets.forEach(s => {
        const count = s.sets || 1;
        for (let i = 0; i < count; i++) flatSets.push({weight: s.weight, reps: s.reps});
      });
      const maxW = Math.max(...flatSets.map(s => s.weight), 1);
      const minW = Math.min(...flatSets.map(s => s.weight));
      const totalReps = flatSets.reduce((a, s) => a + s.reps, 0);
      const bestWeight = maxW;
      const barMaxH = 36;
      const barMinH = 10;
      const numBars = flatSets.length;
      const barW = Math.min(28, Math.max(14, Math.floor(180 / numBars) - 4));

      const bars = flatSets.map((s, i) => {
        const ratio = maxW === minW ? 1 : (s.weight - minW) / (maxW - minW);
        const h = Math.round(barMinH + ratio * (barMaxH - barMinH));
        const isMax = s.weight === maxW;
        return `<div style="display:flex;flex-direction:column;align-items:center;gap:2px;">
          <div style="width:${barW}px;height:${h}px;background:${isMax ? dc('#2563eb','#4f8ef7') : dc('#93c5fd','#3b5a8a')};border-radius:4px 4px 2px 2px;"></div>
          <span style="font-size:9px;color:#9ca3af;font-variant-numeric:tabular-nums;">${s.reps}r</span>
        </div>`;
      }).join('');

      const setDetail = `
        <div style="display:flex;align-items:flex-end;justify-content:space-between;margin-top:8px;">
          <div style="display:flex;align-items:flex-end;gap:3px;">${bars}</div>
          <div style="text-align:right;">
            <div style="font-size:18px;font-weight:800;color:${dc('#1a2332','#f0f1f3')};line-height:1;">${bestWeight}<span style="font-size:11px;font-weight:500;color:#9ca3af;"> lbs</span></div>
            <div style="font-size:11px;color:#9ca3af;margin-top:2px;">${totalSetsForEx} sets · ${totalReps} reps</div>
          </div>
        </div>`;

      return `<div class="history-row">
        <p style="font-weight:700;font-size:14px;color:${dc('#1a2332','#f0f1f3')};margin:0 0 3px;">${exName}</p>
        ${setDetail}
      </div>`;
    }).join('');

    return `<div style="background:white;border-radius:20px;border:1px solid #f0f1f3;overflow:hidden;margin-bottom:12px;">
      <div style="padding:16px 20px;border-bottom:1px solid #f0f1f3;display:flex;align-items:center;justify-content:space-between;">
        <h3 style="font-size:15px;font-weight:700;color:#1a2332;margin:0;">${date}</h3>
        <button style="display:flex;align-items:center;gap:5px;font-size:13px;font-weight:600;color:#1a2332;background:none;border:none;cursor:pointer;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1a2332" stroke-width="2" stroke-linecap="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
          Share
        </button>
      </div>
      <div style="padding:12px 16px;">${exerciseRows}</div>
      <div style="padding:12px 16px;background:#f5f6f8;border-top:1px solid #f0f1f3;display:grid;grid-template-columns:repeat(4,1fr);gap:8px;">
        <div style="text-align:center;"><p style="font-size:11px;color:#9ca3af;font-weight:500;margin:0;">Reps</p><p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">${dayTotalReps}</p></div>
        <div style="text-align:center;"><p style="font-size:11px;color:#9ca3af;font-weight:500;margin:0;">Sets</p><p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">${dayTotalSets}</p></div>
        <div style="text-align:center;"><p style="font-size:11px;color:#9ca3af;font-weight:500;margin:0;">Volume</p><p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">${fmtVol(dayTotalVol)}</p></div>
        <div style="text-align:center;"><p style="font-size:11px;color:#9ca3af;font-weight:500;margin:0;">Exercises</p><p style="font-size:16px;font-weight:800;color:#1a2332;margin:0;">${dayExCount}</p></div>
      </div>
    </div>`;
  }).join('');
}
// ─── END HISTORY ───

// ─── SEED DEMO DATA (runs once if no log exists) ───────────────────────────
(function seedDemoData() {
  const existing = JSON.parse(localStorage.getItem('flextab_workoutlog') || '[]');
  if (existing.length >= 35) return; // already has full demo data
  const demo = [
    // Bench Press – 6 sessions, progressive overload
    {name:'Bench Press', date:'Jan 27, 2026', ts:1, sets:3, reps:5, weight:205, isCardio:false},
    {name:'Bench Press', date:'Jan 31, 2026', ts:2, sets:3, reps:5, weight:210, isCardio:false},
    {name:'Bench Press', date:'Feb 4,  2026',  ts:3, sets:4, reps:5, weight:215, isCardio:false},
    {name:'Bench Press', date:'Feb 8,  2026',  ts:4, sets:4, reps:5, weight:220, isCardio:false},
    {name:'Bench Press', date:'Feb 13, 2026', ts:5, sets:4, reps:5, weight:225, isCardio:false},
    {name:'Bench Press', date:'Feb 19, 2026', ts:6, sets:4, reps:5, weight:235, isCardio:false},
    // Deadlift – 5 sessions
    {name:'Deadlift', date:'Jan 28, 2026', ts:7,  sets:3, reps:5, weight:295, isCardio:false},
    {name:'Deadlift', date:'Feb 2,  2026',  ts:8,  sets:3, reps:5, weight:305, isCardio:false},
    {name:'Deadlift', date:'Feb 7,  2026',  ts:9,  sets:4, reps:5, weight:315, isCardio:false},
    {name:'Deadlift', date:'Feb 14, 2026', ts:10, sets:4, reps:5, weight:325, isCardio:false},
    {name:'Deadlift', date:'Feb 19, 2026', ts:11, sets:4, reps:5, weight:335, isCardio:false},
    // Squat – 5 sessions
    {name:'Squat', date:'Jan 29, 2026', ts:12, sets:4, reps:6, weight:255, isCardio:false},
    {name:'Squat', date:'Feb 3,  2026',  ts:13, sets:4, reps:6, weight:265, isCardio:false},
    {name:'Squat', date:'Feb 9,  2026',  ts:14, sets:4, reps:6, weight:275, isCardio:false},
    {name:'Squat', date:'Feb 15, 2026', ts:15, sets:4, reps:6, weight:285, isCardio:false},
    {name:'Squat', date:'Feb 20, 2026', ts:16, sets:4, reps:6, weight:295, isCardio:false},
    // Overhead Press – 4 sessions
    {name:'Overhead Press', date:'Jan 30, 2026', ts:17, sets:3, reps:8, weight:125, isCardio:false},
    {name:'Overhead Press', date:'Feb 5,  2026',  ts:18, sets:3, reps:8, weight:130, isCardio:false},
    {name:'Overhead Press', date:'Feb 12, 2026', ts:19, sets:3, reps:8, weight:135, isCardio:false},
    {name:'Overhead Press', date:'Feb 18, 2026', ts:20, sets:3, reps:8, weight:140, isCardio:false},
    // Cable Row – 4 sessions
    {name:'Cable Row', date:'Jan 28, 2026', ts:21, sets:3, reps:10, weight:145, isCardio:false},
    {name:'Cable Row', date:'Feb 4,  2026',  ts:22, sets:3, reps:10, weight:150, isCardio:false},
    {name:'Cable Row', date:'Feb 11, 2026', ts:23, sets:3, reps:10, weight:155, isCardio:false},
    {name:'Cable Row', date:'Feb 18, 2026', ts:24, sets:3, reps:10, weight:160, isCardio:false},
    // Incline Bench Press – 3 sessions
    {name:'Incline Bench Press', date:'Feb 4,  2026',  ts:25, sets:3, reps:8, weight:165, isCardio:false},
    {name:'Incline Bench Press', date:'Feb 11, 2026', ts:26, sets:3, reps:8, weight:170, isCardio:false},
    {name:'Incline Bench Press', date:'Feb 18, 2026', ts:27, sets:3, reps:8, weight:175, isCardio:false},
    // Feb 20 – Bench Press pyramid (varied weight & reps per set)
    {name:'Bench Press', date:'Feb 20, 2026', ts:28, sets:1, reps:10, weight:185, isCardio:false},
    {name:'Bench Press', date:'Feb 20, 2026', ts:29, sets:1, reps:8,  weight:205, isCardio:false},
    {name:'Bench Press', date:'Feb 20, 2026', ts:30, sets:1, reps:6,  weight:225, isCardio:false},
    {name:'Bench Press', date:'Feb 20, 2026', ts:31, sets:1, reps:4,  weight:245, isCardio:false},
    // Feb 20 – Deadlift drop sets (varied weight, same reps)
    {name:'Deadlift', date:'Feb 20, 2026', ts:32, sets:1, reps:5, weight:335, isCardio:false},
    {name:'Deadlift', date:'Feb 20, 2026', ts:33, sets:1, reps:5, weight:315, isCardio:false},
    {name:'Deadlift', date:'Feb 20, 2026', ts:34, sets:1, reps:5, weight:295, isCardio:false},
    // Feb 20 – Cable Row (same weight/reps — shows compact view alongside varied)
    {name:'Cable Row', date:'Feb 20, 2026', ts:35, sets:3, reps:10, weight:160, isCardio:false},
  ];
  localStorage.setItem('flextab_workoutlog', JSON.stringify(demo));
})();

// ─── WORKOUT TIMER ────────────────────────────────────────────────────────────
let _timerInterval = null;
let _timerSeconds  = 0;
let _timerRunning  = false;

function startWorkoutTimer() {
  if (_timerRunning) return; // already running
  _timerRunning = true;
  const wrap = document.getElementById('workout-timer-wrap');
  wrap.style.display = 'flex';
  _timerInterval = setInterval(() => {
    _timerSeconds++;
    const m = String(Math.floor(_timerSeconds / 60)).padStart(2, '0');
    const s = String(_timerSeconds % 60).padStart(2, '0');
    document.getElementById('workout-timer-display').textContent = m + ':' + s;
  }, 1000);
  // Show pause icon
  document.getElementById('timer-pause-icon').innerHTML = '<rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/>';
}

function toggleWorkoutTimer() {
  if (_timerRunning) {
    // Pause
    clearInterval(_timerInterval);
    _timerRunning = false;
    // Swap to play icon
    document.getElementById('timer-pause-icon').innerHTML = '<polygon points="5 3 19 12 5 21 5 3"/>';
  } else {
    // Resume
    _timerRunning = true;
    _timerInterval = setInterval(() => {
      _timerSeconds++;
      const m = String(Math.floor(_timerSeconds / 60)).padStart(2, '0');
      const s = String(_timerSeconds % 60).padStart(2, '0');
      document.getElementById('workout-timer-display').textContent = m + ':' + s;
    }, 1000);
    // Swap back to pause icon
    document.getElementById('timer-pause-icon').innerHTML = '<rect x="6" y="4" width="4" height="16" rx="1"/><rect x="14" y="4" width="4" height="16" rx="1"/>';
  }
}

function endWorkout() {
  // Capture stats before clearing
  const durationSecs = _timerSeconds;
  const m = String(Math.floor(durationSecs / 60)).padStart(2, '0');
  const s = String(durationSecs % 60).padStart(2, '0');
  const exCount = exercises.length;
  let totalSets = 0, totalVol = 0;
  exercises.forEach(ex => {
    const d = exerciseData[ex.name];
    if (d) {
      totalSets += (d.sets || 1);
      totalVol  += (d.sets || 1) * (d.reps || 0) * (d.weight || 0);
    }
  });

  // Stop timer
  clearInterval(_timerInterval);
  _timerRunning = false;
  _timerSeconds = 0;
  document.getElementById('workout-timer-display').textContent = '00:00';
  document.getElementById('workout-timer-wrap').style.display = 'none';

  // Populate summary modal
  document.getElementById('ew-duration').textContent  = m + ':' + s;
  document.getElementById('ew-exercises').textContent = exCount;
  document.getElementById('ew-sets').textContent      = totalSets;
  document.getElementById('ew-volume').textContent    = totalVol.toLocaleString() + ' lbs';

  // Show modal
  const overlay = document.getElementById('end-workout-overlay');
  overlay.style.display = 'flex';

  // Clear exercises so the log page returns to empty state
  exercises = [];
  exerciseData = {};
  currentExerciseIndex = 0;
  renderExercises();
}

function goToHistory() {
  dismissEndWorkout();
  setSidebarNav('history');
}

function dismissEndWorkout() {
  document.getElementById('end-workout-overlay').style.display = 'none';
}
// ─── END WORKOUT TIMER ────────────────────────────────────────────────────────

function openCalendar() {
  calYear = today.getFullYear();
  calMonth = today.getMonth();
  renderCalendar();
  document.getElementById('calendar-overlay').style.display = 'block';
  requestAnimationFrame(() => {
    requestAnimationFrame(() => {
      document.getElementById('calendar-popup').style.bottom = '0';
    });
  });
}

function closeCalendar() {
  document.getElementById('calendar-popup').style.bottom = '-100%';
  setTimeout(() => {
    document.getElementById('calendar-overlay').style.display = 'none';
  }, 350);
}

function calNav(dir) {
  calMonth += dir;
  if (calMonth > 11) { calMonth = 0; calYear++; }
  if (calMonth < 0)  { calMonth = 11; calYear--; }
  renderCalendar();
}

function renderCalendar() {
  const label = new Date(calYear, calMonth, 1)
    .toLocaleDateString('en-US', { month:'long', year:'numeric' });
  document.getElementById('cal-month-label').textContent = label;

  const firstDow = new Date(calYear, calMonth, 1).getDay();
  const daysInMonth = new Date(calYear, calMonth + 1, 0).getDate();

  let html = '';
  // Empty cells before first day
  for (let i = 0; i < firstDow; i++) {
    html += `<div></div>`;
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const isToday = calYear === today.getFullYear() && calMonth === today.getMonth() && d === today.getDate();
    const isFuture = new Date(calYear, calMonth, d) > today;
    const workout = isWorkoutDay(calYear, calMonth, d);

    let bg, color, border, fontWeight;
    if (isToday) {
      bg = '#dbeafe'; color = '#1e40af'; border = '1.5px solid #93c5fd'; fontWeight = '700';
    } else if (isFuture) {
      bg = 'transparent'; color = '#d1d5db'; border = 'none'; fontWeight = '400';
    } else if (workout) {
      bg = '#1a2332'; color = 'white'; border = 'none'; fontWeight = '700';
    } else {
      bg = '#f0f1f3'; color = '#9ca3af'; border = '1px solid #e2e4e7'; fontWeight = '400';
    }

    html += `
      <div style="aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:50%;background:${bg};color:${color};border:${border};font-size:13px;font-weight:${fontWeight};cursor:${isFuture ? 'default' : 'pointer'};">
        ${d}
      </div>`;
  }

  document.getElementById('cal-grid').innerHTML = html;
}

// ─── PROFILE ACTION SHEET ───────────────────────────────────────────────────
function openProfileActionSheet() {
  document.getElementById('profile-action-sheet').style.display = 'flex';
  document.getElementById('profile-action-overlay').style.display = 'block';
}
function closeProfileActionSheet() {
  document.getElementById('profile-action-sheet').style.display = 'none';
  document.getElementById('profile-action-overlay').style.display = 'none';
}
function profilePostWorkoutLog() {
  closeProfileActionSheet();
  // Switch to community tab and open the composer in workout log mode
  setActiveNav('community');
  setTimeout(() => {
    const composer = document.getElementById('community-composer');
    if (composer) { composer.style.display = 'block'; }
    const logBtn = document.getElementById('composer-mode-log');
    if (logBtn) logBtn.click();
  }, 100);
}
function profilePostPhoto() {
  closeProfileActionSheet();
  setActiveNav('community');
  setTimeout(() => {
    const composer = document.getElementById('community-composer');
    if (composer) { composer.style.display = 'block'; }
    const mediaBtn = document.getElementById('composer-mode-media');
    if (mediaBtn) mediaBtn.click();
    const fileInput = document.getElementById('composer-file-input');
    if (fileInput) { fileInput.accept = 'image/*'; fileInput.click(); }
  }, 100);
}
function profilePostVideo() {
  closeProfileActionSheet();
  setActiveNav('community');
  setTimeout(() => {
    const composer = document.getElementById('community-composer');
    if (composer) { composer.style.display = 'block'; }
    const mediaBtn = document.getElementById('composer-mode-media');
    if (mediaBtn) mediaBtn.click();
    const fileInput = document.getElementById('composer-file-input');
    if (fileInput) { fileInput.accept = 'video/*'; fileInput.click(); }
  }, 100);
}
</script>

<!-- Profile Action Sheet -->
<div id="profile-action-overlay" onclick="closeProfileActionSheet()" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);z-index:200;"></div>
<div id="profile-action-sheet" style="display:none;position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:700px;background:white;border-radius:24px 24px 0 0;z-index:201;flex-direction:column;padding:0 0 32px;">
  <div style="width:40px;height:4px;background:#e2e4e7;border-radius:2px;margin:12px auto 20px;"></div>
  <p style="font-size:13px;font-weight:600;color:#9ca3af;text-transform:uppercase;letter-spacing:.08em;padding:0 20px 12px;">Share to Community</p>
  <button onclick="profilePostWorkoutLog()" style="display:flex;align-items:center;gap:14px;width:100%;padding:14px 20px;background:none;border:none;cursor:pointer;text-align:left;" onmouseenter="this.style.background='#f5f6f8'" onmouseleave="this.style.background='none'">
    <div style="width:42px;height:42px;border-radius:12px;background:#1a2332;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/><rect x="9" y="3" width="6" height="4" rx="1"/><line x1="9" y1="12" x2="15" y2="12"/><line x1="9" y1="16" x2="13" y2="16"/></svg>
    </div>
    <div>
      <p style="font-size:15px;font-weight:700;color:#1a2332;margin:0 0 2px;">Workout Log</p>
      <p style="font-size:12px;color:#6b7280;margin:0;">Share your latest session with the community</p>
    </div>
  </button>
  <button onclick="profilePostPhoto()" style="display:flex;align-items:center;gap:14px;width:100%;padding:14px 20px;background:none;border:none;cursor:pointer;text-align:left;" onmouseenter="this.style.background='#f5f6f8'" onmouseleave="this.style.background='none'">
    <div style="width:42px;height:42px;border-radius:12px;background:#1a2332;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
    </div>
    <div>
      <p style="font-size:15px;font-weight:700;color:#1a2332;margin:0 0 2px;">Photo</p>
      <p style="font-size:12px;color:#6b7280;margin:0;">Upload a photo to share your progress</p>
    </div>
  </button>
  <button onclick="profilePostVideo()" style="display:flex;align-items:center;gap:14px;width:100%;padding:14px 20px;background:none;border:none;cursor:pointer;text-align:left;" onmouseenter="this.style.background='#f5f6f8'" onmouseleave="this.style.background='none'">
    <div style="width:42px;height:42px;border-radius:12px;background:#1a2332;display:flex;align-items:center;justify-content:center;flex-shrink:0;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>
    </div>
    <div>
      <p style="font-size:15px;font-weight:700;color:#1a2332;margin:0 0 2px;">Video</p>
      <p style="font-size:12px;color:#6b7280;margin:0;">Upload a video to show your workout in action</p>
    </div>
  </button>
  <button onclick="closeProfileActionSheet()" style="margin:8px 20px 0;padding:14px;background:#f5f6f8;border:none;border-radius:14px;font-size:15px;font-weight:600;color:#6b7280;cursor:pointer;width:calc(100% - 40px);">
    Cancel
  </button>
</div>

</body>
</html>
